<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B. AI ì¶”ë¡  ì—”ì§„ & ë„êµ¬ PoC ìƒì„¸ ì„¤ê³„</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #eaeaea;
            --text-secondary: #a0a0a0;
            --accent: #e94560;
            --accent-secondary: #00d9ff;
            --code-bg: #0d1117;
            --border-color: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
            border-bottom: 3px solid var(--accent);
            padding-bottom: 1rem;
        }

        h1 + p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--accent-secondary);
            margin: 2.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        h3 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin: 1.5rem 0 0.8rem;
        }

        p {
            margin-bottom: 1rem;
        }

        a {
            color: #f39c12;
            text-decoration: underline;
        }

        a:hover {
            color: #f1c40f;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 0.8rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            color: var(--accent-secondary);
            font-weight: 600;
        }

        tr:hover {
            background: var(--bg-tertiary);
        }

        pre {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        code {
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
        }

        .mermaid {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
        }

        /* ì»¨í…ìŠ¤íŠ¸ ëˆ„ì  íë¦„ ë‹¤ì´ì–´ê·¸ë¨ ì „ìš© ìŠ¤íƒ€ì¼ */
        .context-flow-diagram svg {
            min-width: 100%;
        }
        .context-flow-diagram .node foreignObject {
            overflow: visible !important;
        }
        .context-flow-diagram .node foreignObject > div {
            min-width: 220px !important;
            white-space: pre-wrap !important;
        }

        .tech-stack {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }

        .tech-badge {
            background: var(--bg-tertiary);
            color: var(--accent-secondary);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            border: 1px solid var(--accent-secondary);
        }

        .section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
        }

        .highlight {
            color: var(--accent);
            font-weight: 600;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 2rem 0;
        }

        .folder-structure {
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .folder-structure .folder {
            color: var(--accent-secondary);
        }

        .folder-structure .file {
            color: var(--text-secondary);
        }

        .folder-structure .comment {
            color: #6a737d;
        }

        /* ëª©ì°¨ ìŠ¤íƒ€ì¼ */
        .toc {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
        }

        .toc h2 {
            margin: 0 0 1rem 0;
            font-size: 1.3rem;
            color: var(--accent);
            border-bottom: none;
        }

        .toc ol {
            margin: 0;
            padding-left: 1.5rem;
        }

        .toc li {
            margin: 0.5rem 0;
        }

        .toc a {
            color: var(--accent-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .toc a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        .toc .sub-toc {
            margin-top: 0.3rem;
            padding-left: 1.2rem;
            font-size: 0.9rem;
        }

        .toc .sub-toc li {
            margin: 0.3rem 0;
        }

        .toc .sub-toc a {
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>B. AI ì¶”ë¡  ì—”ì§„ & ë„êµ¬ PoC ìƒì„¸ ì„¤ê³„</h1>
        <p>PoC-3b (ReAct Loop), PoC-5 (Human Feedback), PoC-6 (API Request) í†µí•© ì„¤ê³„</p>

        <!-- ëª©ì°¨ -->
        <nav class="toc">
            <h2>ëª©ì°¨</h2>
            <ol>
                <li><a href="#overview">ê°œìš”</a></li>
                <li><a href="#architecture">ì „ì²´ ì•„í‚¤í…ì²˜</a>
                    <ol class="sub-toc">
                        <li><a href="#arch-system">ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°</a></li>
                        <li><a href="#arch-context">ì»¨í…ìŠ¤íŠ¸ ëˆ„ì  íë¦„</a></li>
                        <li><a href="#arch-risk">ìœ„í—˜ë„ ê¸°ë°˜ Human Feedback íŠ¸ë¦¬ê±°</a></li>
                        <li><a href="#arch-error">ì—ëŸ¬ ë° íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬</a></li>
                        <li><a href="#arch-callback">Callback Manager ì¸í„°í˜ì´ìŠ¤</a></li>
                        <li><a href="#arch-cli">CLI í…ŒìŠ¤íŠ¸ í™˜ê²½</a></li>
                        <li><a href="#arch-rag">C ê³„ì¸µ ì¸í„°í˜ì´ìŠ¤ (ë¸”ë™ë°•ìŠ¤)</a></li>
                        <li><a href="#arch-response">ì‘ë‹µ í¬ë§·</a></li>
                    </ol>
                </li>
                <li><a href="#folder">í´ë” êµ¬ì¡°</a></li>
                <li><a href="#react">ReAct Loop ì„¤ê³„</a>
                    <ol class="sub-toc">
                        <li><a href="#react">ReAct íŒ¨í„´ ê°œìš”</a></li>
                        <li><a href="#reason-output">Reason ì¶œë ¥ êµ¬ì¡°</a></li>
                    </ol>
                </li>
                <li><a href="#human-feedback">Human Feedback Tool ì„¤ê³„</a></li>
                <li><a href="#api-request">API Request Tool ì„¤ê³„</a></li>
                <li><a href="#test">í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</a></li>
            </ol>
        </nav>

        <!-- 1. ê°œìš” -->
        <h2 id="overview">1. ê°œìš”</h2>

        <h3>1.1 ëª©í‘œ</h3>
        <p>DSPy í”„ë ˆì„ì›Œí¬ ê¸°ë°˜ìœ¼ë¡œ FinOps AI ì–´ì‹œìŠ¤í„´íŠ¸ì˜ í•µì‹¬ ì¶”ë¡  ì—”ì§„ê³¼ ë„êµ¬ë¥¼ êµ¬í˜„í•œë‹¤.</p>

        <h3>1.2 ë²”ìœ„</h3>
        <table>
            <thead>
                <tr>
                    <th>PoC</th>
                    <th>í•µì‹¬ ê¸°ëŠ¥</th>
                    <th>ì˜ì¡´ì„±</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>3b</td>
                    <td>ReAct Loop (Reason â†’ Act â†’ Observe)</td>
                    <td>3a (DSPy)</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>Human Feedback Tool (ì‚¬ìš©ì ë˜ë¬¼ìŒ)</td>
                    <td>3b</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>API Request Tool (ë°ì´í„° ìš”ì²­)</td>
                    <td>3b</td>
                </tr>
            </tbody>
        </table>

        <h3>1.3 ê¸°ìˆ  ìŠ¤íƒ</h3>
        <div class="tech-stack">
            <span class="tech-badge">DSPy</span>
            <span class="tech-badge">OpenAI API (gpt-5-nano)</span>
            <span class="tech-badge">asyncio</span>
            <span class="tech-badge">Python 3.11+</span>
        </div>

        <hr>

        <!-- 2. ì „ì²´ ì•„í‚¤í…ì²˜ -->
        <h2 id="architecture">2. ì „ì²´ ì•„í‚¤í…ì²˜</h2>

        <h3 id="arch-system">2.1 ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°</h3>
        <div class="mermaid">
flowchart TB
    subgraph Input["ì…ë ¥ ê³„ì¸µ"]
        Q[/"ì‚¬ìš©ì ì§ˆë¬¸"/]
        DOM[/"í™”ë©´ DOM<br/>(~2000 í† í°)"/]
    end

    subgraph RAG["ì •ë³´ ì†ŒìŠ¤ ê³„ì¸µ (C) - ë¸”ë™ë°•ìŠ¤"]
        SearchCtx["ğŸ” search_context(query)<br/>â†’ ContextResult"]
    end

    subgraph ReActAgent["ReAct Agent (max 5íšŒ ë°˜ë³µ)"]
        CTX["ğŸ“‹ Context Manager<br/>(ì§ˆë¬¸+DOM+RAG í†µí•©)"]

        subgraph Loop["ReAct Loop"]
            Reason["ğŸ§  Reason<br/>(LLM ì¶”ë¡ )"]
            Act["âš¡ Act<br/>(í–‰ë™ ê²°ì •)"]
            Router{"Tool Router"}
            Observe["ğŸ‘ï¸ Observe<br/>(ê²°ê³¼ ê´€ì°°)"]
        end

        Reason --> Act
        Act --> Router
    end

    subgraph Tools["ë„êµ¬ ê³„ì¸µ (B)"]
        subgraph HumanTool["ask_human"]
            Risk{"ğŸš¦ ìœ„í—˜ë„<br/>íŒë‹¨"}
            HF["ğŸ‘¤ Human<br/>Feedback"]
        end
        API["ğŸ“¡ API Request"]
        PostProc["ğŸ”„ ProgramOfThought<br/>ì‘ë‹µ í›„ì²˜ë¦¬"]
    end

    subgraph Callback["ì½œë°± ê³„ì¸µ"]
        CM["Callback Manager<br/>(Interface)"]
        Mock["ğŸ”§ Mock<br/>(CLI í…ŒìŠ¤íŠ¸)"]
        Real["ğŸŒ WebSocket<br/>(í”„ë¡œë•ì…˜)"]
    end

    Client["ğŸ–¥ï¸ Client"]

    %% ì…ë ¥ íë¦„ (â‘ â‘¡)
    Q -->|"â‘ "| CTX
    DOM -->|"â‘¡"| CTX

    %% RAG ì¡°íšŒ (â‘¢â‘£) - ë¸”ë™ë°•ìŠ¤
    Q -->|"â‘¢ query"| SearchCtx
    SearchCtx -->|"â‘£ ContextResult"| CTX

    %% ReAct Loop (â‘¤)
    CTX -->|"â‘¤"| Reason

    %% Tool Router ë¶„ê¸° (â‘¥â‘¦)
    Router -->|"â‘¥-a ask_human"| Risk
    Risk -->|"â‘¦-a critical/high"| HF
    Risk -->|"â‘¦-b low: ìŠ¤í‚µ"| Observe
    Router -->|"â‘¥-b request_api"| API
    Router -->|"â‘¥-c finish"| Answer[/"âœ… ìµœì¢… ë‹µë³€"/]

    %% ë„êµ¬ â†’ Callback (â‘§)
    HF -->|"â‘§"| CM
    API -->|"â‘§"| CM

    %% Callback êµ¬í˜„ì²´
    CM -.->|"PoC"| Mock
    CM -.->|"Production"| Real
    Real <-->|"â‘¨"| Client
    Mock <-->|"â‘¨"| CLI["ğŸ’» í„°ë¯¸ë„"]

    %% API ì‘ë‹µ í›„ì²˜ë¦¬ (â‘©)
    CM -->|"â‘© ëŒ€ìš©ëŸ‰ ì‘ë‹µ"| PostProc
    PostProc -->|"â‘ª í•µì‹¬ ë°ì´í„°"| Observe

    %% Human Feedbackì€ ì§ì ‘ Observeë¡œ
    CM -->|"â‘© ì‚¬ìš©ì ì‘ë‹µ"| Observe

    %% Observation ë°˜í™˜ (â‘«)
    Observe -->|"â‘« ì»¨í…ìŠ¤íŠ¸ ëˆ„ì "| CTX

    %% ìŠ¤íƒ€ì¼
    style Q fill:#e94560,color:#fff
    style DOM fill:#e94560,color:#fff
    style Answer fill:#00d9ff,color:#000
    style Risk fill:#f39c12,color:#000
    style CM fill:#0f3460
    style Client fill:#16213e
    style CLI fill:#16213e
    style SearchCtx fill:#9b59b6,color:#fff
    style PostProc fill:#8e44ad,color:#fff
        </div>

        <table>
            <thead>
                <tr><th>ìˆœì„œ</th><th>íë¦„</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>â‘ â‘¡</strong></td><td>ì…ë ¥ â†’ Context</td><td>ì‚¬ìš©ì ì§ˆë¬¸ + í™”ë©´ DOMì„ Context Managerì— ì „ë‹¬</td></tr>
                <tr style="background: rgba(155, 89, 182, 0.2);"><td><strong>â‘¢</strong></td><td>search_context í˜¸ì¶œ</td><td>C ê³„ì¸µì— query ì „ë‹¬ (ë¸”ë™ë°•ìŠ¤)</td></tr>
                <tr style="background: rgba(155, 89, 182, 0.2);"><td><strong>â‘£</strong></td><td>ContextResult ìˆ˜ì‹ </td><td>memory, faq, menu í†µí•© ê²°ê³¼ ë°˜í™˜</td></tr>
                <tr><td><strong>â‘¤</strong></td><td>Context â†’ Reason</td><td>í†µí•©ëœ ì»¨í…ìŠ¤íŠ¸ë¡œ LLM ì¶”ë¡  ì‹œì‘</td></tr>
                <tr><td><strong>â‘¥</strong></td><td>Router ë¶„ê¸°</td><td>a) ask_human, b) request_api, c) finish ì¤‘ ì„ íƒ</td></tr>
                <tr><td><strong>â‘¦</strong></td><td>ìœ„í—˜ë„ íŒë‹¨</td><td>a) critical/high â†’ í™•ì¸ ìš”ì²­, b) low â†’ ìŠ¤í‚µ</td></tr>
                <tr><td><strong>â‘§</strong></td><td>ë„êµ¬ â†’ Callback</td><td>ask_human: input() ëŒ€ê¸° / request_api: 2ì´ˆ í›„ Mock ë°ì´í„°</td></tr>
                <tr><td><strong>â‘¨</strong></td><td>Client í†µì‹ </td><td>Mock(í„°ë¯¸ë„) ë˜ëŠ” Real(WebSocket) í†µì‹ </td></tr>
                <tr style="background: rgba(142, 68, 173, 0.2);"><td><strong>â‘©</strong></td><td>ì‘ë‹µ ë¶„ê¸°</td><td>ask_human â†’ ì§ì ‘ Observe / request_api â†’ í›„ì²˜ë¦¬ ë¶„ê¸°</td></tr>
                <tr style="background: rgba(142, 68, 173, 0.2);"><td><strong>â‘ª</strong></td><td>ProgramOfThought í›„ì²˜ë¦¬</td><td>ëŒ€ìš©ëŸ‰ API ì‘ë‹µ ì‹œ í•µì‹¬ ë°ì´í„°ë§Œ ì¶”ì¶œ (Python ì½”ë“œ ìƒì„±â†’ì‹¤í–‰)</td></tr>
                <tr><td><strong>â‘«</strong></td><td>ì»¨í…ìŠ¤íŠ¸ ëˆ„ì </td><td>ê²°ê³¼ë¥¼ Contextì— ì¶”ê°€ â†’ â‘¤ë¡œ ë°˜ë³µ (max 5íšŒ)</td></tr>
            </tbody>
        </table>

        <table>
            <thead>
                <tr><th>ê³„ì¸µ</th><th>ìš”ì†Œ</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td rowspan="2"><strong>ì…ë ¥</strong></td><td>ì‚¬ìš©ì ì§ˆë¬¸</td><td>ìì—°ì–´ ì§ˆë¬¸ (ì˜ˆ: "ë¹„ìš© ì¤„ì—¬ì¤˜")</td></tr>
                <tr><td>í™”ë©´ DOM</td><td>í˜„ì¬ í™”ë©´ì˜ ë¹„ìš©/ìì‚° ì •ë³´ (~2000 í† í°)</td></tr>
                <tr style="background: rgba(155, 89, 182, 0.2);"><td><strong>ì •ë³´ ì†ŒìŠ¤ (C)</strong></td><td>ğŸ” search_context</td><td>ë¸”ë™ë°•ìŠ¤ - memory, faq, menu í†µí•© ì¡°íšŒ</td></tr>
                <tr><td rowspan="5"><strong>ReAct Agent</strong></td><td>Context Manager</td><td>ì§ˆë¬¸ + DOM + RAG ê²°ê³¼ í†µí•© ê´€ë¦¬</td></tr>
                <tr><td>ğŸ§  Reason</td><td>LLMì´ ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ìƒí™© ë¶„ì„</td></tr>
                <tr><td>âš¡ Act</td><td>ë‹¤ìŒ í–‰ë™ ê²°ì • (ë„êµ¬ or finish)</td></tr>
                <tr><td>Tool Router</td><td>ì„ íƒëœ ë„êµ¬ë¡œ ìš”ì²­ ë¼ìš°íŒ…</td></tr>
                <tr><td>ğŸ‘ï¸ Observe</td><td>ë„êµ¬ ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ì— ì¶”ê°€</td></tr>
                <tr><td rowspan="4"><strong>ë„êµ¬ (B)</strong></td><td>ğŸš¦ ìœ„í—˜ë„ íŒë‹¨</td><td>critical/high â†’ í™•ì¸, low â†’ ìŠ¤í‚µ</td></tr>
                <tr><td>ğŸ‘¤ Human Feedback</td><td>ì‚¬ìš©ìì—ê²Œ ë˜ë¬¼ìŒ (timeout: 2ë¶„)</td></tr>
                <tr><td>ğŸ“¡ API Request</td><td>í´ë¼ì´ì–¸íŠ¸ì— ë°ì´í„° ìš”ì²­ (timeout: 60ì´ˆ)</td></tr>
                <tr><td>ğŸ”„ ProgramOfThought í›„ì²˜ë¦¬</td><td>ëŒ€ìš©ëŸ‰ API ì‘ë‹µ â†’ í•µì‹¬ ë°ì´í„° ì¶”ì¶œ</td></tr>
                <tr><td rowspan="3"><strong>ì½œë°±</strong></td><td>Callback Manager</td><td>ë„êµ¬â†”í´ë¼ì´ì–¸íŠ¸ í†µì‹  ì¸í„°í˜ì´ìŠ¤</td></tr>
                <tr><td>ğŸ”§ Mock</td><td>CLI í…ŒìŠ¤íŠ¸ìš© (input, TEST_DATA)</td></tr>
                <tr><td>ğŸŒ WebSocket</td><td>í”„ë¡œë•ì…˜ìš© (PoC-1 í†µí•©)</td></tr>
            </tbody>
        </table>

        <h3 id="arch-context">2.2 ì»¨í…ìŠ¤íŠ¸ ëˆ„ì  íë¦„</h3>
        <p>ReAct Loop ê° Stepì—ì„œ ì»¨í…ìŠ¤íŠ¸ê°€ ì–´ë–»ê²Œ ëˆ„ì ë˜ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

        <div class="mermaid context-flow-diagram">
%%{init: {'flowchart': {'useMaxWidth': false}}}%%
flowchart TB
    subgraph Step0["ì´ˆê¸° ì»¨í…ìŠ¤íŠ¸"]
        direction LR
        Q0["`ğŸ“ **ì§ˆë¬¸**
        ë¹„ìš© ì¤„ì—¬ì¤˜             `"]
        D0["`ğŸ–¥ï¸ **DOM**
        EC2 $15,000
        Lambda $3,000...`"]
        R0["`ğŸ“š **RAG**
        ContextResult
        (faq, menu)`"]
    end

    subgraph Step1["Step 1: ì„œë¹„ìŠ¤ ëª…í™•í™”"]
        direction LR
        T1["`ğŸ§  **Thought**
        ì‚¬ìš©ìê°€ ë¹„ìš© ì ˆê°ì„ ì›í•˜ì§€ë§Œ
        ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ì§€ ë¶ˆëª…í™•í•¨    `"]
        A1["`âš¡ **Action**
        ask_human            `"]
        O1["`ğŸ‘ï¸ **Observation**
        ì‚¬ìš©ì ì‘ë‹µ: EC2ìš”       `"]
    end

    subgraph Step2["Step 2: ë°ì´í„° ìˆ˜ì§‘"]
        direction LR
        T2["`ğŸ§  **Thought**
        EC2 ë¹„ìš© ìƒì„¸ ë°ì´í„°ê°€
        í•„ìš”í•¨               `"]
        A2["`âš¡ **Action**
        request_api          `"]
        O2["`ğŸ‘ï¸ **Observation**
        nov: $10,000
        dec: $15,000         `"]
    end

    subgraph Step3["Step 3: ë¶„ì„ ì™„ë£Œ"]
        direction LR
        T3["`ğŸ§  **Thought**
        EC2 ë¹„ìš© 50% ì¦ê°€ í™•ì¸
        RI ë¯¸ì ìš©ì´ ì›ì¸
        ë‹µë³€ ê°€ëŠ¥             `"]
        A3["`âš¡ **Action**
        finish               `"]
        F3["`âœ… **Answer**
        EC2 ë¹„ìš©ì´ 50% ì¦ê°€í–ˆìŠµë‹ˆë‹¤
        RI ì ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤      `"]
    end

    Step0 --> Step1 --> Step2 --> Step3

    style Q0 fill:#e94560,color:#fff
    style D0 fill:#e94560,color:#fff
    style R0 fill:#9b59b6,color:#fff
    style F3 fill:#00d9ff,color:#000
        </div>

        <table>
            <thead>
                <tr><th>Step</th><th>ì»¨í…ìŠ¤íŠ¸ ë‚´ìš©</th><th>í† í° (ì˜ˆìƒ)</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>ì´ˆê¸°</strong></td><td>ì§ˆë¬¸ + DOM + RAG (memory, faq, menu)</td><td>~2,500</td></tr>
                <tr><td><strong>Step 1 í›„</strong></td><td>+ Thought1 + Action1 + Observation1</td><td>~2,800</td></tr>
                <tr><td><strong>Step 2 í›„</strong></td><td>+ Thought2 + Action2 + Observation2</td><td>~3,200</td></tr>
                <tr><td><strong>Step 3</strong></td><td>ìµœì¢… ë‹µë³€ ìƒì„±</td><td>~3,500</td></tr>
            </tbody>
        </table>

        <h3 id="arch-risk">2.3 ìœ„í—˜ë„ ê¸°ë°˜ Human Feedback íŠ¸ë¦¬ê±°</h3>
        <p><code>ask_human</code> í˜¸ì¶œ ì‹œ ìœ„í—˜ë„ì— ë”°ë¼ ì‹¤ì œ ì‚¬ìš©ì í™•ì¸ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.</p>

        <div class="mermaid">
flowchart TD
    Start["ask_human í˜¸ì¶œ"] --> Detect["ì•¡ì…˜ í‚¤ì›Œë“œ ê°ì§€"]

    Detect --> Check{"ìœ„í—˜ë„ ë ˆë²¨?"}

    Check -->|"ğŸ”´ critical<br/>(ì‚­ì œ, ê²°ì œ)"| MustAsk["ë¬´ì¡°ê±´ í™•ì¸"]
    Check -->|"ğŸŸ  high<br/>(ì„¤ì • ë³€ê²½)"| ConfCheck{"ì‹ ë¢°ë„ < 80%?"}
    Check -->|"ğŸŸ¢ medium/low<br/>(ì¡°íšŒ, ë¶„ì„)"| Skip["í™•ì¸ ìŠ¤í‚µ"]

    ConfCheck -->|"Yes"| ShouldAsk["í™•ì¸ ìš”ì²­"]
    ConfCheck -->|"No"| Skip

    MustAsk --> Call["Callback Manager í˜¸ì¶œ"]
    ShouldAsk --> Call
    Skip --> Default["ê¸°ë³¸ê°’ ë˜ëŠ” ìë™ ì§„í–‰"]

    Call --> Wait{"ì‘ë‹µ ëŒ€ê¸°<br/>(2ë¶„)"}
    Wait -->|"ì‘ë‹µ ìˆ˜ì‹ "| Return["Observation ë°˜í™˜"]
    Wait -->|"íƒ€ì„ì•„ì›ƒ"| Timeout["ê¸°ë³¸ê°’ ë°˜í™˜"]

    Default --> Return
    Timeout --> Return

    style MustAsk fill:#e94560
    style ShouldAsk fill:#f39c12
    style Skip fill:#27ae60
    style Timeout fill:#e74c3c
        </div>

        <table>
            <thead>
                <tr><th>ìœ„í—˜ë„</th><th>í‚¤ì›Œë“œ ì˜ˆì‹œ</th><th>ë™ì‘</th></tr>
            </thead>
            <tbody>
                <tr><td>ğŸ”´ <strong>critical</strong></td><td>ì‚­ì œ, ì¢…ë£Œ, ê²°ì œ, í•´ì§€</td><td>í•­ìƒ ì‚¬ìš©ì í™•ì¸ í•„ìˆ˜</td></tr>
                <tr><td>ğŸŸ  <strong>high</strong></td><td>ë³€ê²½, ìˆ˜ì •, ì ìš©, ì„¤ì •</td><td>ì‹ ë¢°ë„ 80% ë¯¸ë§Œ ì‹œ í™•ì¸</td></tr>
                <tr><td>ğŸŸ¢ <strong>medium</strong></td><td>ë¶„ì„, ë¹„êµ, ì¶”ì²œ</td><td>í™•ì¸ ì—†ì´ ì§„í–‰</td></tr>
                <tr><td>ğŸŸ¢ <strong>low</strong></td><td>ì¡°íšŒ, í™•ì¸, ë³´ê¸°</td><td>í™•ì¸ ì—†ì´ ì§„í–‰</td></tr>
            </tbody>
        </table>

        <h3 id="arch-error">2.4 ì—ëŸ¬ ë° íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬</h3>

        <div class="mermaid">
flowchart TD
    subgraph Normal["ì •ìƒ íë¦„"]
        Tool["ë„êµ¬ ì‹¤í–‰"] --> CM["Callback Manager"]
        CM --> Wait["ì‘ë‹µ ëŒ€ê¸°"]
        Wait --> Success["âœ… ì„±ê³µ"]
    end

    subgraph Errors["ì˜ˆì™¸ ì²˜ë¦¬"]
        Wait -->|"ask_human 2ë¶„"| T1["â±ï¸ íƒ€ì„ì•„ì›ƒ"]
        Wait -->|"request_api 60ì´ˆ"| T2["â±ï¸ íƒ€ì„ì•„ì›ƒ"]
        CM -->|"ì—°ê²° ëŠê¹€"| E1["ğŸ”Œ ì—°ê²° ì˜¤ë¥˜"]
        CM -->|"ì˜ëª»ëœ ì‘ë‹µ"| E2["âŒ íŒŒì‹± ì˜¤ë¥˜"]
    end

    T1 --> Fallback1["ê¸°ë³¸ ì‘ë‹µ: 'ì‚¬ìš©ì ì‘ë‹µ ì—†ìŒ'"]
    T2 --> Fallback2["ê¸°ë³¸ ì‘ë‹µ: 'ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨'"]
    E1 --> Retry["ì¬ì‹œë„ (1íšŒ)"]
    E2 --> Fallback3["ê¸°ë³¸ ì‘ë‹µ ë°˜í™˜"]

    Retry -->|"ì‹¤íŒ¨"| Fallback3

    Success --> Continue["ë‹¤ìŒ Step ì§„í–‰"]
    Fallback1 --> Continue
    Fallback2 --> Continue
    Fallback3 --> Continue

    style Success fill:#27ae60
    style T1 fill:#f39c12
    style T2 fill:#f39c12
    style E1 fill:#e74c3c
    style E2 fill:#e74c3c
        </div>

        <table>
            <thead>
                <tr><th>ì˜ˆì™¸ ìƒí™©</th><th>ì²˜ë¦¬ ë°©ì‹</th><th>Observation ê°’</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>ask_human íƒ€ì„ì•„ì›ƒ</strong></td><td>2ë¶„ í›„ íƒ€ì„ì•„ì›ƒ Observation ë°˜í™˜</td><td>"ì‚¬ìš©ì ì‘ë‹µ ì—†ìŒ (íƒ€ì„ì•„ì›ƒ)" â†’ LLMì´ ìƒí™©ì— ë§ëŠ” ì‘ë‹µ ìƒì„±</td></tr>
                <tr><td><strong>request_api íƒ€ì„ì•„ì›ƒ</strong></td><td>60ì´ˆ í›„ ê¸°ë³¸ê°’ ë°˜í™˜</td><td>"ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨ (íƒ€ì„ì•„ì›ƒ)"</td></tr>
                <tr><td><strong>WebSocket ì—°ê²° ëŠê¹€</strong></td><td>1íšŒ ì¬ì‹œë„ í›„ ì‹¤íŒ¨ ì²˜ë¦¬</td><td>"ì—°ê²° ì˜¤ë¥˜"</td></tr>
                <tr><td><strong>ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜</strong></td><td>ê¸°ë³¸ê°’ ë°˜í™˜</td><td>"ì‘ë‹µ ì²˜ë¦¬ ì‹¤íŒ¨"</td></tr>
                <tr><td><strong>MAX_ITERATIONS ë„ë‹¬</strong></td><td>Reasonì´ ë©”ë‰´ ì„ íƒ í›„ Fallback ì‘ë‹µ</td><td>ì•„ë˜ ìƒì„¸ ì°¸ê³ </td></tr>
            </tbody>
        </table>

        <div class="section">
            <h4>MAX_ITERATIONS ë„ë‹¬ ì‹œ ì²˜ë¦¬</h4>
            <p>5íšŒ ë°˜ë³µ í›„ì—ë„ ì™„ë£Œë˜ì§€ ì•Šìœ¼ë©´, Reasonì´ Loop ì¤‘ ìˆ˜ì§‘ëœ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë©”ë‰´ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p>

<pre><code>Thought: 5íšŒ ì‹œë„í–ˆìœ¼ë‚˜ ì™„ì „í•œ ë¶„ì„ ë¶ˆê°€. EC2 ê´€ë ¨ ì§ˆë¬¸ì´ì—ˆìœ¼ë¯€ë¡œ RI Management ë©”ë‰´ ì¶”ì²œ.
Action: finish
Answer: í˜„ì¬ ë¬¸ì˜í•˜ì‹  ë‚´ìš©ì€ ì™„ì „í•œ íŒŒì•…ì´ ì–´ë µìŠµë‹ˆë‹¤.
        RI Management ë©”ë‰´ì—ì„œ í™•ì¸í•´ë³´ì‹œê² ì–´ìš”? â†’ /cost/ri-management

        ğŸ’¡ ë” êµ¬ì²´ì ì¸ ì§ˆë¬¸ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</code></pre>

            <table>
                <thead>
                    <tr><th>ë‹¨ê³„</th><th>ë™ì‘</th></tr>
                </thead>
                <tbody>
                    <tr><td>1. ì»¨í…ìŠ¤íŠ¸ ë¶„ì„</td><td>Loop ì¤‘ ìˆ˜ì§‘ëœ Observations ê¸°ë°˜ í‚¤ì›Œë“œ íŒŒì•…</td></tr>
                    <tr><td>2. ë©”ë‰´ ì„ íƒ</td><td>ContextResult.menuì—ì„œ ê´€ë ¨ ë©”ë‰´ ì„ íƒ (LLM íŒë‹¨)</td></tr>
                    <tr><td>3. Fallback ì‘ë‹µ</td><td>"íŒŒì•… ì–´ë ¤ì›€ + ë©”ë‰´ ì•ˆë‚´ + ì¬ì§ˆë¬¸ ìœ ë„"</td></tr>
                </tbody>
            </table>
            <p><strong>Fallback:</strong> LLM íŒë‹¨ì´ ì–´ë ¤ìš°ë©´ <code>menu[0]</code> (rank 1) ì‚¬ìš©</p>
        </div>

        <h3 id="arch-callback">2.5 Callback Manager ì¸í„°í˜ì´ìŠ¤</h3>
        <p>Mock(í…ŒìŠ¤íŠ¸)ê³¼ Real(í”„ë¡œë•ì…˜) êµ¬í˜„ì²´ê°€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

        <div class="mermaid">
classDiagram
    class CallbackManagerInterface {
        &lt;&lt;interface&gt;&gt;
        +request_and_wait(request, timeout) Any
        +resolve(request_id, data) void
    }

    class MockCallbackManager {
        -test_data: dict
        +request_and_wait() ask_humanâ†’input(), request_apiâ†’2ì´ˆ í›„ TEST_DATA
    }

    class WebSocketCallbackManager {
        -websocket: WebSocket
        -pending_requests: dict
        +request_and_wait() WebSocket ì†¡ìˆ˜ì‹ 
        +resolve() Future ì™„ë£Œ
    }

    CallbackManagerInterface <|.. MockCallbackManager : implements
    CallbackManagerInterface <|.. WebSocketCallbackManager : implements

    ReActAgent --> CallbackManagerInterface : uses
        </div>

        <table>
            <thead>
                <tr><th>êµ¬í˜„ì²´</th><th>ìš©ë„</th><th>ask_human ì²˜ë¦¬</th><th>request_api ì²˜ë¦¬</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>MockCallbackManager</strong></td><td>CLI í…ŒìŠ¤íŠ¸</td><td><code>input()</code> ëŒ€ê¸°</td><td>2ì´ˆ ëŒ€ê¸° í›„ TEST_DATA ë°˜í™˜</td></tr>
                <tr><td><strong>WebSocketCallbackManager</strong></td><td>í”„ë¡œë•ì…˜</td><td>WebSocket ì „ì†¡ + Future ëŒ€ê¸°</td><td>WebSocket ì „ì†¡ + Future ëŒ€ê¸°</td></tr>
            </tbody>
        </table>

        <h3 id="arch-cli">2.6 CLI í…ŒìŠ¤íŠ¸ í™˜ê²½ (Mock Callback)</h3>
        <p>PoC ë…ë¦½ ì‹¤í–‰ì„ ìœ„í•´ <strong>CLI ê¸°ë°˜ Mock Callback</strong>ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. ì‹¤ì œ WebSocket ì—°ë™ì€ PoC-1 í†µí•© ì‹œ ì ìš©í•©ë‹ˆë‹¤.</p>

        <div class="mermaid">
flowchart LR
    subgraph "CLI í…ŒìŠ¤íŠ¸ í™˜ê²½"
        User["ğŸ‘¤ í„°ë¯¸ë„ ì…ë ¥"]
        Mock["ğŸ”§ Mock Callback"]
        Agent["ğŸ¤– ReAct Agent"]
        TestData["ğŸ“¦ TEST_DATA<br/>(api_result.json)"]
    end

    Agent -->|"â‘  ask_human"| Mock
    Mock -->|"â‘¡ input()"| User
    User -->|"â‘¢ ì‘ë‹µ"| Mock
    Mock -->|"â‘£ Observation"| Agent

    Agent -->|"â‘  request_api"| Mock
    Mock -->|"â‘¡ 2ì´ˆ ëŒ€ê¸°"| TestData
    TestData -->|"â‘¢ Mock ë°ì´í„°"| Mock
    Mock -->|"â‘£ Observation"| Agent

    style User fill:#e94560,color:#fff
    style Mock fill:#f39c12,color:#000
    style Agent fill:#0f3460
    style TestData fill:#27ae60,color:#fff
        </div>

        <table>
            <thead>
                <tr><th>ìš”ì†Œ</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td>ğŸ‘¤ <strong>í„°ë¯¸ë„ ì…ë ¥</strong></td><td>CLIì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥ (<code>input()</code>)</td></tr>
                <tr><td>ğŸ”§ <strong>Mock Callback</strong></td><td>WebSocket ëŒ€ì‹  ë¡œì»¬ì—ì„œ ì½œë°± ì‹œë®¬ë ˆì´ì…˜</td></tr>
                <tr><td>ğŸ¤– <strong>ReAct Agent</strong></td><td>ì‹¤ì œ ì¶”ë¡  ì—”ì§„ (í”„ë¡œë•ì…˜ê³¼ ë™ì¼)</td></tr>
                <tr><td>ğŸ“¦ <strong>TEST_DATA</strong></td><td>api_result.json ê¸°ë°˜ Mock ë°ì´í„°</td></tr>
                <tr><td><strong>ask_human íë¦„</strong></td><td>Agent â†’ Mock â†’ input() ëŒ€ê¸° â†’ ì‚¬ìš©ì ì…ë ¥ â†’ Agent</td></tr>
                <tr><td><strong>request_api íë¦„</strong></td><td>Agent â†’ Mock â†’ 2ì´ˆ ëŒ€ê¸° â†’ TEST_DATA ë°˜í™˜ â†’ Agent</td></tr>
            </tbody>
        </table>

        <h3 id="arch-rag">2.7 C ê³„ì¸µ ì¸í„°í˜ì´ìŠ¤ ëª…ì„¸ (ë¸”ë™ë°•ìŠ¤)</h3>
        <p>C ê³„ì¸µ(ë©”ëª¨ë¦¬/RAG)ì€ ë‹¨ì¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ì œê³µë˜ë©°, B ê³„ì¸µì€ ë‚´ë¶€ êµ¬í˜„ì„ ì•Œ í•„ìš” ì—†ì´ í˜¸ì¶œë§Œ í•©ë‹ˆë‹¤.</p>

        <h4>í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜</h4>
        <pre><code>def search_context(query: str) -> ContextResult</code></pre>

        <table>
            <thead>
                <tr><th>í•­ëª©</th><th>ê°’</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>ì…ë ¥</strong></td><td><code>query: str</code> - ì‚¬ìš©ì ì§ˆì˜ (ì›ë³¸)</td></tr>
                <tr><td><strong>ì¶œë ¥</strong></td><td><code>ContextResult</code> - í†µí•© ì¡°íšŒ ê²°ê³¼</td></tr>
                <tr><td><strong>í˜¸ì¶œ ì‹œì </strong></td><td>ReAct Loop ì§„ì… ì „ 1íšŒ</td></tr>
            </tbody>
        </table>

        <h4>ContextResult êµ¬ì¡°</h4>
        <pre><code>@dataclass
class ContextResult:
    memory: list[str]    # ê´€ë ¨ ëŒ€í™” íˆìŠ¤í† ë¦¬ (ì—†ìœ¼ë©´ [])
    faq: list[str]       # ê´€ë ¨ FAQ/Manual (ì—†ìœ¼ë©´ [])
    menu: list[dict]     # ê´€ë ¨ ë©”ë‰´ ì •ë³´ - ë­í‚¹ìˆœ (ì—†ìœ¼ë©´ [])</code></pre>

        <table>
            <thead>
                <tr><th>í•„ë“œ</th><th>íƒ€ì…</th><th>í•„ìˆ˜</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><code>memory</code></td><td><code>list[str]</code></td><td>âœ…</td><td>ê´€ë ¨ ëŒ€í™” íˆìŠ¤í† ë¦¬ (ì—†ìœ¼ë©´ <code>[]</code>)</td></tr>
                <tr><td><code>faq</code></td><td><code>list[str]</code></td><td>âœ…</td><td>ê´€ë ¨ FAQ/Manual ë¬¸ì„œ (ì—†ìœ¼ë©´ <code>[]</code>)</td></tr>
                <tr><td><code>menu</code></td><td><code>list[dict]</code></td><td>âœ…</td><td>ê´€ë ¨ ë©”ë‰´ ì •ë³´ - ë­í‚¹ìˆœ (ì—†ìœ¼ë©´ <code>[]</code>)</td></tr>
            </tbody>
        </table>

        <h4>menu í•­ëª© êµ¬ì¡°</h4>
        <pre><code>{
    "rank": int,      # ì¶”ì²œ ìˆœìœ„ (1ì´ ê°€ì¥ ë†’ìŒ)
    "name": str,      # ë©”ë‰´ í‘œì‹œëª…
    "path": str,      # ë©”ë‰´ ê²½ë¡œ (ê³„ì¸µ)
    "url": str        # ì‹¤ì œ URL
}</code></pre>

        <table>
            <thead>
                <tr><th>í•„ë“œ</th><th>íƒ€ì…</th><th>í•„ìˆ˜</th><th>ì„¤ëª…</th><th>ì˜ˆì‹œ</th></tr>
            </thead>
            <tbody>
                <tr><td><code>rank</code></td><td><code>int</code></td><td>âœ…</td><td>ì¶”ì²œ ìˆœìœ„ (1=ìµœìš°ì„ )</td><td><code>1</code></td></tr>
                <tr><td><code>name</code></td><td><code>str</code></td><td>âœ…</td><td>ë©”ë‰´ í‘œì‹œëª…</td><td><code>"Cost Analysis"</code></td></tr>
                <tr><td><code>path</code></td><td><code>str</code></td><td>âœ…</td><td>ë©”ë‰´ ê²½ë¡œ</td><td><code>"/cost/analysis"</code></td></tr>
                <tr><td><code>url</code></td><td><code>str</code></td><td>âœ…</td><td>ì‹¤ì œ ì´ë™ URL</td><td><code>"/cost/cost-analysis/usage"</code></td></tr>
            </tbody>
        </table>

        <h4>ì‘ë‹µ ì˜ˆì‹œ</h4>
        <pre><code>{
  "memory": [
    "ì´ì „ì— EC2 ë¹„ìš© ê´€ë ¨ ë¬¸ì˜í•˜ì…¨ìŠµë‹ˆë‹¤."
  ],
  "faq": [
    "Q: EC2 ë¹„ìš©ì„ ì¤„ì´ë ¤ë©´? A: RI ë˜ëŠ” Savings Plan ì ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
    "Q: ë¹„ìš© ì•Œë¦¼ ì„¤ì •ì€? A: Cost > Alerts ë©”ë‰´ì—ì„œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤."
  ],
  "menu": [
    {"rank": 1, "name": "Cost Analysis", "path": "/cost/analysis", "url": "/cost/cost-analysis/usage"},
    {"rank": 2, "name": "RI Management", "path": "/cost/ri", "url": "/cost/ri-management"},
    {"rank": 3, "name": "Savings Plan", "path": "/cost/sp", "url": "/cost/savings-plan"}
  ]
}</code></pre>

        <h4>ë¹ˆ ì‘ë‹µ ì˜ˆì‹œ (í•´ë‹¹ ì†ŒìŠ¤ ì—†ìŒ)</h4>
        <pre><code>{
  "memory": [],
  "faq": [],
  "menu": []
}</code></pre>

        <h4>B ê³„ì¸µ ì²˜ë¦¬ ê·œì¹™</h4>
        <table>
            <thead>
                <tr><th>í•„ë“œ</th><th>ë¹ˆ ë°°ì—´ ì‹œ</th><th>ê°’ ìˆì„ ì‹œ</th></tr>
            </thead>
            <tbody>
                <tr><td><code>memory</code></td><td>Contextì—ì„œ ì œì™¸</td><td>Contextì— í¬í•¨</td></tr>
                <tr><td><code>faq</code></td><td>Contextì—ì„œ ì œì™¸</td><td>Contextì— í¬í•¨</td></tr>
                <tr><td><code>menu</code></td><td>Fallback ë©”ë‰´ ì•ˆë‚´ ë¶ˆê°€</td><td>MAX_ITERATIONS ì‹œ LLMì´ ì„ íƒ</td></tr>
            </tbody>
        </table>

        <h4>ì±…ì„ ë¶„ë¦¬</h4>
        <table>
            <thead>
                <tr><th>Bê°€ í•˜ëŠ” ê²ƒ</th><th>Bê°€ ì•ˆ í•˜ëŠ” ê²ƒ (C ë‹´ë‹¹)</th></tr>
            </thead>
            <tbody>
                <tr><td><code>search_context(query)</code> í˜¸ì¶œ</td><td>ì–´ë–¤ ì†ŒìŠ¤ë¥¼ ì¡°íšŒí• ì§€ íŒë‹¨ (Adaptive)</td></tr>
                <tr><td>ContextResult ìˆ˜ì‹ </td><td>Memory/FAQ/Menu ì‹¤ì œ ì¡°íšŒ ë¡œì§</td></tr>
                <tr><td>ë¹ˆ ë°°ì—´ í•„í„°ë§ í›„ Context ì¡°ë¦½</td><td>RAG ë‚´ë¶€ êµ¬í˜„</td></tr>
                <tr><td>MAX_ITERATIONS ì‹œ menuì—ì„œ LLM ì„ íƒ</td><td>menu ë­í‚¹ ê²°ì •</td></tr>
            </tbody>
        </table>

        <div class="section">
            <h4>PoC Mock êµ¬í˜„ (LLM ê¸°ë°˜)</h4>
            <p>PoC ë‹¨ê³„ì—ì„œ C ê³„ì¸µì€ <strong>LLMì„ í™œìš©í•œ Mock</strong>ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤. ì‹¤ì œ RAG ì—†ì´ë„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

            <div class="mermaid">
flowchart LR
    Query["query"] --> MockC["ğŸ¤– Mock C Layer<br/>(LLM)"]
    MockC --> Result["ContextResult"]

    style MockC fill:#9b59b6,color:#fff
            </div>

            <table>
                <thead>
                    <tr><th>í•­ëª©</th><th>ì„¤ëª…</th></tr>
                </thead>
                <tbody>
                    <tr><td><strong>ì…ë ¥</strong></td><td>ì‚¬ìš©ì query</td></tr>
                    <tr><td><strong>ì²˜ë¦¬</strong></td><td>LLMì´ queryë¥¼ ë¶„ì„í•˜ì—¬ ContextResult í¬ë§·ì— ë§ëŠ” ì‘ë‹µ ìƒì„±</td></tr>
                    <tr><td><strong>ì¶œë ¥</strong></td><td>ContextResult (memory, faq, menu)</td></tr>
                </tbody>
            </table>

            <h5>Mock LLM í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ</h5>
<pre><code>ë‹¹ì‹ ì€ FinOps ì‹œìŠ¤í…œì˜ RAG ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.
ì‚¬ìš©ì ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ ê´€ë ¨ ì •ë³´ë¥¼ ContextResult í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”.

ì§ˆë¬¸: "{query}"

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "memory": ["ê´€ë ¨ ëŒ€í™” íˆìŠ¤í† ë¦¬..."],
  "faq": ["Q: ê´€ë ¨ FAQ A: ë‹µë³€..."],
  "menu": [
    {"rank": 1, "name": "ë©”ë‰´ëª…", "path": "/ê²½ë¡œ", "url": "/ì‹¤ì œURL"}
  ]
}

- FinOps/í´ë¼ìš°ë“œ ë¹„ìš© ê´€ë ¨ ì§ˆë¬¸ì— ì ì ˆí•œ FAQì™€ ë©”ë‰´ë¥¼ ìƒì„±
- ê´€ë ¨ ì—†ëŠ” í•„ë“œëŠ” ë¹ˆ ë°°ì—´ []ë¡œ ë°˜í™˜</code></pre>

            <table>
                <thead>
                    <tr><th>ì¥ì </th><th>ì„¤ëª…</th></tr>
                </thead>
                <tbody>
                    <tr><td>âœ… ë…ë¦½ í…ŒìŠ¤íŠ¸</td><td>C ê³„ì¸µ êµ¬í˜„ ì—†ì´ B ê³„ì¸µ ë‹¨ë… í…ŒìŠ¤íŠ¸ ê°€ëŠ¥</td></tr>
                    <tr><td>âœ… ìœ ì—°í•œ ì‘ë‹µ</td><td>ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ì— ì ì ˆí•œ Mock ë°ì´í„° ìë™ ìƒì„±</td></tr>
                    <tr><td>âœ… ì¸í„°í˜ì´ìŠ¤ ê²€ì¦</td><td>ì‹¤ì œ ì—°ë™ ì „ ContextResult í¬ë§· ê²€ì¦</td></tr>
                    <tr><td>âœ… ë‹¨ì¼ ëª¨ë¸</td><td>ReAct Agentì™€ ë™ì¼í•œ gpt-5-nano ì‚¬ìš© (ì†ë„+ë¹„ìš©)</td></tr>
                </tbody>
            </table>
        </div>

        <h3 id="arch-response">2.8 ì‘ë‹µ í¬ë§·</h3>
        <p>ìµœì¢… ë‹µë³€ì€ ì•„ë˜ êµ¬ì¡°ë¥¼ ë”°ë¥´ë©°, RAG ì¬í˜¸ì¶œ ëŒ€ì‹  <strong>í›„ì† ì§ˆë¬¸ ìœ ë„</strong>ë¡œ ì¶”ê°€ ì •ë³´ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>

        <div class="mermaid">
flowchart TB
    subgraph Response["ìµœì¢… ì‘ë‹µ êµ¬ì¡°"]
        Answer["ğŸ“‹ Answer (í•„ìˆ˜)<br/>ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ ë‹µë³€"]
        FollowUp["ğŸ’¡ Follow-up Hint (ì„ íƒ)<br/>í›„ì† ì§ˆë¬¸ ìœ ë„"]
        MenuLink["ğŸ”— Menu Link (Fallback)<br/>ê´€ë ¨ ë©”ë‰´ ì•ˆë‚´"]
    end

    Answer --> FollowUp
    FollowUp -.-> MenuLink

    style Answer fill:#00d9ff,color:#000
    style FollowUp fill:#27ae60,color:#fff
    style MenuLink fill:#f39c12,color:#000
        </div>

        <table>
            <thead>
                <tr><th>êµ¬ì„± ìš”ì†Œ</th><th>í•„ìˆ˜</th><th>ì„¤ëª…</th><th>ì˜ˆì‹œ</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ğŸ“‹ Answer</strong></td>
                    <td>âœ…</td>
                    <td>ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ ë‹µë³€</td>
                    <td>"EC2 ë¹„ìš©ì´ 25% ì¦ê°€í–ˆìŠµë‹ˆë‹¤. RI ì ìš©ìœ¼ë¡œ 30% ì ˆê° ê°€ëŠ¥í•©ë‹ˆë‹¤."</td>
                </tr>
                <tr>
                    <td><strong>ğŸ’¡ Follow-up Hint</strong></td>
                    <td>ì„ íƒ</td>
                    <td>ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•  ìˆ˜ ìˆëŠ” ê²½ìš° í›„ì† ì§ˆë¬¸ ìœ ë„</td>
                    <td>"ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë¹„ìš©ë„ ê¶ê¸ˆí•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”."</td>
                </tr>
                <tr>
                    <td><strong>ğŸ”— Menu Link</strong></td>
                    <td>Fallback</td>
                    <td>ì²˜ë¦¬ ë¶ˆê°€ ì‹œ ê´€ë ¨ ë©”ë‰´ ì•ˆë‚´</td>
                    <td>"ìƒì„¸ ë¶„ì„ì€ Cost Analysis ë©”ë‰´ì—ì„œ í™•ì¸í•˜ì„¸ìš”. â†’ /cost/analysis"</td>
                </tr>
            </tbody>
        </table>

        <h4>ì‘ë‹µ ìƒ˜í”Œ</h4>

        <div class="section">
            <h5>âœ… ì •ìƒ ì‘ë‹µ (Answer + Follow-up)</h5>
<pre><code>EC2 ë¹„ìš©ì´ ì „ì›” ëŒ€ë¹„ 25% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.

ğŸ“Š ì£¼ìš” ì›ì¸:
â€¢ RI ë¯¸ì ìš© ì¸ìŠ¤í„´ìŠ¤ 3ëŒ€ ì¶”ê°€
â€¢ m5.xlarge â†’ m5.2xlarge ì—…ê·¸ë ˆì´ë“œ 2ê±´

ğŸ’¡ RI ì ìš© ì‹œ ì•½ 30% ì ˆê°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---
ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë¹„ìš©ì´ë‚˜ ìƒì„¸ ë¶„ì„ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”.</code></pre>
        </div>

        <div class="section">
            <h5>âš ï¸ ë¶€ë¶„ ì‘ë‹µ (Answer + Menu Link)</h5>
<pre><code>í˜„ì¬ í™”ë©´ì—ì„œ EC2 ë¹„ìš© $15,000ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

ìƒì„¸ ë¹„ìš© ì¶”ì´ì™€ ìµœì í™” ë°©ì•ˆì€ ì•„ë˜ ë©”ë‰´ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ”— RI Management â†’ /cost/ri-management
ğŸ”— Savings Plan â†’ /cost/savings-plan</code></pre>
        </div>

        <div class="section">
            <h5>âŒ Fallback ì‘ë‹µ (MAX_ITERATIONS ë„ë‹¬)</h5>
<pre><code>ìš”ì²­í•˜ì‹  ë‚´ìš©ì„ ì™„ì „íˆ íŒŒì•…í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.

ì•„ë˜ ë©”ë‰´ì—ì„œ ì§ì ‘ í™•ì¸í•´ë³´ì‹œê² ì–´ìš”?

ğŸ”— Cost Analysis â†’ /cost/cost-analysis/usage

---
ğŸ’¡ ë” êµ¬ì²´ì ì¸ ì§ˆë¬¸ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.
   ì˜ˆ: "ì´ë²ˆ ë‹¬ EC2 ë¹„ìš©ì´ ì™œ ì¦ê°€í–ˆì–´?"</code></pre>
        </div>

        <div class="section">
            <h5>â±ï¸ íƒ€ì„ì•„ì›ƒ ì‘ë‹µ (ask_human 2ë¶„ ì´ˆê³¼)</h5>
<pre><code>ì‘ë‹µì„ ê¸°ë‹¤ë ¸ì§€ë§Œ í™•ì¸ì´ ì—†ì–´ ì‘ì—…ì„ ì§„í–‰í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ì¤€ë¹„ë˜ì‹œë©´ ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.

ğŸ”— ê´€ë ¨ ë©”ë‰´: Cost Analysis â†’ /cost/cost-analysis/usage</code></pre>
        </div>

        <div class="section">
            <h4>ì„¤ê³„ ê²°ì •: RAG ì¬í˜¸ì¶œ vs í›„ì† ì§ˆë¬¸ ìœ ë„</h4>
            <table>
                <thead>
                    <tr><th>ì ‘ê·¼ ë°©ì‹</th><th>ì„¤ëª…</th><th>ì±„íƒ</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Loop ë‚´ RAG ì¬í˜¸ì¶œ</td>
                        <td>ReAct Loop ì¤‘ ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸ í•„ìš” ì‹œ C ê³„ì¸µ ì¬í˜¸ì¶œ</td>
                        <td>âŒ</td>
                    </tr>
                    <tr>
                        <td><strong>í›„ì† ì§ˆë¬¸ ìœ ë„</strong></td>
                        <td>ì‘ë‹µ ëì— ì¶”ê°€ ì§ˆë¬¸ ì•ˆë‚´ â†’ ë‹¤ìŒ í„´ì—ì„œ ìƒˆ RAG ì¡°íšŒ</td>
                        <td>âœ…</td>
                    </tr>
                </tbody>
            </table>
            <p><strong>ì´ìœ :</strong> ë‹¨ìˆœí•¨ ìœ ì§€, ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” íë¦„, ë§¤ í„´ fresh ì»¨í…ìŠ¤íŠ¸</p>
        </div>

        <hr>

        <!-- 3. í´ë” êµ¬ì¡° -->
        <h2 id="folder">3. í´ë” êµ¬ì¡°</h2>

        <div class="mermaid">
graph TB
    subgraph "poc/b_ai_engine/"
        design["ğŸ“ design/"]
        docs["ğŸ“ docs/"]
        mock["ğŸ“ mock/"]
        poc3a["ğŸ“ poc_3a_dspy_research/ âœ…"]
        src["ğŸ“ src/"]
    end

    subgraph "src/"
        config["âš™ï¸ config.py"]
        main["ğŸš€ main.py"]
        agent["ğŸ¤– agent.py"]
        tools["ğŸ“ tools/"]
        callback["ğŸ“ callback/"]
    end

    agent --> sig["Signature ì¸ë¼ì¸ ì •ì˜"]
    agent --> react["dspy.ReAct êµ¬í˜„"]

    tools --> ask["ask_human.py"]
    tools --> req["request_api.py"]

    callback --> iface["interface.py"]
    callback --> mockcb["mock.py"]

    src --> config
    src --> main
    src --> agent
    src --> tools
    src --> callback

    style design fill:#0f3460
    style docs fill:#0f3460
    style mock fill:#0f3460
    style poc3a fill:#2d5016
    style src fill:#0f3460
        </div>

        <table>
            <thead>
                <tr><th>ìš”ì†Œ</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><code>design/</code></td><td>ì„¤ê³„ ë¬¸ì„œ (ë³¸ ë¬¸ì„œ í¬í•¨)</td></tr>
                <tr><td><code>docs/</code></td><td>ì°¸ê³  ë¬¸ì„œ (ReAct íŒ¨í„´, DSPy ë¶„ì„)</td></tr>
                <tr><td><code>mock/</code></td><td>Mock ë°ì´í„° (DOM, RAG)</td></tr>
                <tr><td><code>poc_3a_dspy_research/</code></td><td>DSPy ë¦¬ì„œì¹˜ ê²°ê³¼ (ì™„ë£Œ, ì°¸ê³ ìš©)</td></tr>
                <tr><td><code>src/</code></td><td>ì‹¤ì œ êµ¬í˜„ ì½”ë“œ</td></tr>
            </tbody>
        </table>

        <h4>src/ ìƒì„¸</h4>
        <table>
            <thead>
                <tr><th>íŒŒì¼/í´ë”</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><code>config.py</code></td><td>ëª¨ë¸ëª… (gpt-5-nano), ìƒìˆ˜, í™˜ê²½ë³€ìˆ˜</td></tr>
                <tr><td><code>main.py</code></td><td>CLI í…ŒìŠ¤íŠ¸ ì§„ì…ì </td></tr>
                <tr><td><code>agent.py</code></td><td>ReAct Agent + Signature ì¸ë¼ì¸ ì •ì˜</td></tr>
                <tr><td><code>tools/</code></td><td>ask_human, request_api ë„êµ¬ (ì¼ë°˜ Python í•¨ìˆ˜)</td></tr>
                <tr><td><code>callback/</code></td><td>Callback Manager (interface + mock êµ¬í˜„ì²´)</td></tr>
            </tbody>
        </table>

        <div class="section">
            <h4>ì„¤ê³„ ê²°ì •: Signature ì¸ë¼ì¸ ì •ì˜</h4>
            <p><code>dspy.ReAct</code> ì‚¬ìš© ì‹œ Signatureë¥¼ ë³„ë„ íŒŒì¼ë¡œ ë¶„ë¦¬í•  í•„ìš” ì—†ìŒ. Agent íŒŒì¼ì— ì¸ë¼ì¸ ì •ì˜.</p>
<pre><code># agent.py
class FinOpsQuestion(dspy.Signature):
    """FinOps ë¹„ìš© ê´€ë ¨ ì§ˆë¬¸ì— ë‹µë³€"""
    question: str = dspy.InputField(desc="ì‚¬ìš©ì ì§ˆë¬¸")
    context: str = dspy.InputField(desc="í™”ë©´ DOM + RAG ê²°ê³¼")
    answer: str = dspy.OutputField(desc="ë¶„ì„ ë‹µë³€")

# ReAct Agent ìƒì„±
agent = dspy.ReAct(
    FinOpsQuestion,
    tools=[ask_human, request_api],
    max_iters=5
)</code></pre>
        </div>

        <hr>

        <!-- 4. ReAct Loop -->
        <h2 id="react">4. ReAct Loop ì„¤ê³„</h2>

        <h3>4.1 ReAct íŒ¨í„´ ê°œìš”</h3>

        <div class="mermaid">
flowchart LR
    Q[/"ì‚¬ìš©ì ì§ˆë¬¸"/] --> R["ğŸ§  Reason<br/>(ìƒê°)"]
    R --> A["âš¡ Act<br/>(í–‰ë™)"]
    A --> O["ğŸ‘ï¸ Observe<br/>(ê´€ì°°)"]
    O -->|"ë°˜ë³µ (max 5íšŒ)"| R
    A -->|"finish"| F[/"ìµœì¢… ë‹µë³€"/]

    style Q fill:#e94560,color:#fff
    style R fill:#0f3460
    style A fill:#0f3460
    style O fill:#0f3460
    style F fill:#00d9ff,color:#000
        </div>

        <table>
            <thead>
                <tr><th>ìš”ì†Œ</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td>ğŸ§  <strong>Reason</strong></td><td>í˜„ì¬ ìƒí™©ì„ ë¶„ì„í•˜ê³  ë‹¤ìŒ í–‰ë™ì„ ê²°ì • (LLM ì¶”ë¡ )</td></tr>
                <tr><td>âš¡ <strong>Act</strong></td><td>ë„êµ¬ í˜¸ì¶œ ë˜ëŠ” <code>finish</code> ì„ íƒ</td></tr>
                <tr><td>ğŸ‘ï¸ <strong>Observe</strong></td><td>ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ë¥¼ ê´€ì°°í•˜ê³  ì»¨í…ìŠ¤íŠ¸ì— ì¶”ê°€</td></tr>
                <tr><td><strong>ë°˜ë³µ</strong></td><td>ìµœëŒ€ 5íšŒê¹Œì§€ Reason â†’ Act â†’ Observe ë°˜ë³µ</td></tr>
                <tr><td><strong>finish</strong></td><td>ìµœì¢… ë‹µë³€ ìƒì„± í›„ ë£¨í”„ ì¢…ë£Œ</td></tr>
            </tbody>
        </table>

        <h3 id="reason-output">4.2 Reason ì¶œë ¥ êµ¬ì¡°</h3>
        <p>Reason ë‹¨ê³„ì—ì„œ LLMì´ ìƒì„±í•˜ëŠ” ì¶œë ¥ êµ¬ì¡°ì…ë‹ˆë‹¤. <code>finish</code> ì„ íƒ ì‹œ Answerë„ í•¨ê»˜ ìƒì„±ë©ë‹ˆë‹¤.</p>

        <table>
            <thead>
                <tr><th>í•„ë“œ</th><th>í•„ìˆ˜</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>Thought</strong></td><td>âœ…</td><td>í˜„ì¬ ìƒí™© ë¶„ì„ ë° íŒë‹¨ ê·¼ê±°</td></tr>
                <tr><td><strong>Action</strong></td><td>âœ…</td><td>ë‹¤ìŒ í–‰ë™: <code>ask_human</code>, <code>request_api</code>, <code>finish</code></td></tr>
                <tr><td><strong>Action Input</strong></td><td>ë„êµ¬ ì‹œ</td><td>ë„êµ¬ í˜¸ì¶œ ì‹œ ì „ë‹¬í•  íŒŒë¼ë¯¸í„°</td></tr>
                <tr><td><strong>Answer</strong></td><td>finish ì‹œ</td><td>ìµœì¢… ë‹µë³€ (finish ì„ íƒ ì‹œì—ë§Œ)</td></tr>
            </tbody>
        </table>

        <div class="section">
            <h4>ì˜ˆì‹œ: ë„êµ¬ í˜¸ì¶œ</h4>
<pre><code>Thought: ì‚¬ìš©ìê°€ ë¹„ìš© ì ˆê°ì„ ì›í•˜ì§€ë§Œ ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ì§€ ë¶ˆëª…í™•í•¨
Action: ask_human
Action Input: "ì–´ë–¤ ì„œë¹„ìŠ¤ì˜ ë¹„ìš©ì„ ì¤„ì¼ê¹Œìš”? (ì˜ˆ: EC2, Lambda, S3)"</code></pre>

            <h4>ì˜ˆì‹œ: ìµœì¢… ë‹µë³€ (finish)</h4>
<pre><code>Thought: EC2 ë¹„ìš© 25% ì¦ê°€ ì›ì¸ íŒŒì•…ë¨. RI ë¯¸ì ìš©ì´ ì£¼ ì›ì¸. ë‹µë³€ ê°€ëŠ¥.
Action: finish
Answer: EC2 ë¹„ìš©ì´ ì „ì›” ëŒ€ë¹„ 25% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.
        ì£¼ìš” ì›ì¸ì€ RI ë¯¸ì ìš© ì¸ìŠ¤í„´ìŠ¤ ì¦ê°€ì…ë‹ˆë‹¤.
        RI ì ìš© ì‹œ ì•½ 30% ì ˆê°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

        ğŸ’¡ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë¹„ìš©ë„ ê¶ê¸ˆí•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”.</code></pre>
        </div>

        <div class="section">
            <p><strong>ì¢…ë£Œ ì¡°ê±´:</strong></p>
            <ul>
                <li><code>finish</code> ì•¡ì…˜ ì„ íƒ</li>
                <li>MAX_ITERATIONS (5íšŒ) ë„ë‹¬</li>
            </ul>
        </div>

        <hr>

        <!-- 5. Human Feedback Tool -->
        <h2 id="human-feedback">5. Human Feedback Tool ì„¤ê³„</h2>

        <h3>5.1 ëª©ì </h3>
        <p>AIê°€ ë¶ˆí™•ì‹¤í•˜ê±°ë‚˜ í™•ì¸ì´ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ë˜ë¬¼ìŒ</p>

        <h3>5.2 ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤</h3>
        <table>
            <thead>
                <tr>
                    <th>ìƒí™©</th>
                    <th>ì˜ˆì‹œ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ëª¨í˜¸í•œ ì§ˆë¬¸</td>
                    <td>"ë¹„ìš© ì¤„ì—¬ì¤˜" â†’ "ì–´ë–¤ ì„œë¹„ìŠ¤ì˜ ë¹„ìš©ì„ ì¤„ì¼ê¹Œìš”?"</td>
                </tr>
                <tr>
                    <td>ìœ„í—˜í•œ ì‘ì—…</td>
                    <td>"ì‚­ì œí•´ì¤˜" â†’ "ì •ë§ ì‚­ì œí• ê¹Œìš”? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)"</td>
                </tr>
                <tr>
                    <td>ì„ íƒ í•„ìš”</td>
                    <td>"ìµœì í™”í•´ì¤˜" â†’ "RI vs Savings Plan ì¤‘ ì„ íƒí•´ì£¼ì„¸ìš”"</td>
                </tr>
            </tbody>
        </table>

        <h3>5.3 Human Feedback íë¦„</h3>
        <div class="mermaid">
sequenceDiagram
    participant Agent as ReAct Agent
    participant Tool as ask_human Tool
    participant WS as WebSocket
    participant Client as Client (User)

    Agent->>Tool: ask_human("ì–´ë–¤ ì„œë¹„ìŠ¤?")
    Tool->>WS: clarification_request
    WS->>Client: ì§ˆë¬¸ í‘œì‹œ

    Note over Client: ì‚¬ìš©ì ì…ë ¥ ëŒ€ê¸°<br/>(timeout: 2ë¶„)

    Client->>WS: "EC2ìš”"
    WS->>Tool: ì‘ë‹µ ì „ë‹¬
    Tool->>Agent: Observation: "EC2ìš”"
        </div>

        <table>
            <thead>
                <tr><th>ìš”ì†Œ</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>ReAct Agent</strong></td><td>ì¶”ë¡  ì—”ì§„, ë„êµ¬ í˜¸ì¶œ ê²°ì •</td></tr>
                <tr><td><strong>ask_human Tool</strong></td><td>ì‚¬ìš©ì ì§ˆë¬¸ ìƒì„± ë° ì‘ë‹µ ëŒ€ê¸°</td></tr>
                <tr><td><strong>WebSocket</strong></td><td>ì„œë²„-í´ë¼ì´ì–¸íŠ¸ ì–‘ë°©í–¥ í†µì‹  ì±„ë„</td></tr>
                <tr><td><strong>Client (User)</strong></td><td>ì‹¤ì œ ì‚¬ìš©ì, ì§ˆë¬¸ì— ì‘ë‹µ</td></tr>
                <tr><td><strong>clarification_request</strong></td><td>ë˜ë¬¼ìŒ ìš”ì²­ ë©”ì‹œì§€ íƒ€ì…</td></tr>
                <tr><td><strong>timeout: 2ë¶„</strong></td><td>ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸° ìµœëŒ€ ì‹œê°„</td></tr>
            </tbody>
        </table>

        <p><strong>ìœ„í—˜ë„ ê¸°ë°˜ ìë™ íŠ¸ë¦¬ê±°:</strong> <a href="#arch-risk">2.3 ìœ„í—˜ë„ ê¸°ë°˜ Human Feedback íŠ¸ë¦¬ê±°</a> ì°¸ì¡°</p>

        <hr>

        <!-- 6. API Request Tool -->
        <h2 id="api-request">6. API Request Tool ì„¤ê³„</h2>

        <h3>6.1 ëª©ì </h3>
        <p>AIê°€ ì¶”ê°€ ë°ì´í„°ê°€ í•„ìš”í•  ë•Œ í´ë¼ì´ì–¸íŠ¸ì— ìì—°ì–´ë¡œ ìš”ì²­</p>

        <h3>6.2 ë™ì‘ íë¦„</h3>
        <div class="mermaid">
sequenceDiagram
    participant LLM
    participant Server
    participant Client

    LLM->>Server: "ì´ë²ˆë‹¬ ë¹„ìš© ë°ì´í„° í•„ìš”"
    Server->>Client: request_api(query)

    Note over Client: API í˜¸ì¶œ<br/>GET /api/costs

    Client->>Server: ì‘ë‹µ ë°ì´í„° (JSON)
    Server->>LLM: Observation

    Note over LLM: ë°ì´í„° ë¶„ì„ í›„<br/>ë‹µë³€ ìƒì„±
        </div>

        <table>
            <thead>
                <tr><th>ìš”ì†Œ</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>LLM</strong></td><td>ë°ì´í„° í•„ìš”ì„± íŒë‹¨, ìì—°ì–´ ì¿¼ë¦¬ ìƒì„±</td></tr>
                <tr><td><strong>Server</strong></td><td>request_api ë„êµ¬ ì‹¤í–‰, ìš”ì²­ ì¤‘ê³„</td></tr>
                <tr><td><strong>Client</strong></td><td>ìì—°ì–´ ì¿¼ë¦¬ â†’ ì‹¤ì œ API í˜¸ì¶œ ë§¤í•‘</td></tr>
                <tr><td><strong>data_request</strong></td><td>ë°ì´í„° ìš”ì²­ ë©”ì‹œì§€ íƒ€ì…</td></tr>
                <tr><td><strong>timeout: 60ì´ˆ</strong></td><td>API ì‘ë‹µ ëŒ€ê¸° ìµœëŒ€ ì‹œê°„ (í´ë¼ì´ì–¸íŠ¸ API í˜¸ì¶œ í¬í•¨)</td></tr>
            </tbody>
        </table>

        <h3>6.3 ì‘ë‹µ í›„ì²˜ë¦¬ (ProgramOfThought)</h3>
        <p>API ì‘ë‹µì´ ëŒ€ìš©ëŸ‰(ìˆ˜ MB)ì¼ ê²½ìš°, <strong>DSPy ProgramOfThought</strong>ë¡œ í•µì‹¬ ë°ì´í„°ë§Œ ì¶”ì¶œí•˜ì—¬ ì»¨í…ìŠ¤íŠ¸ì— í¬í•¨í•©ë‹ˆë‹¤.</p>

        <h4>ë¬¸ì œì </h4>
        <table>
            <thead>
                <tr><th>ë¬¸ì œ</th><th>ì˜í–¥</th></tr>
            </thead>
            <tbody>
                <tr><td>ëŒ€ìš©ëŸ‰ JSON ì‘ë‹µ</td><td>í† í° ë¹„ìš© í­ë°œ, ì»¨í…ìŠ¤íŠ¸ í•œê³„ ì´ˆê³¼</td></tr>
                <tr><td>ë¶ˆí•„ìš”í•œ ë°ì´í„°</td><td>LLM ì¶”ë¡  í’ˆì§ˆ ì €í•˜</td></tr>
            </tbody>
        </table>

        <h4>í•´ê²°: ProgramOfThought í›„ì²˜ë¦¬</h4>
        <div class="mermaid">
flowchart LR
    subgraph "API ì‘ë‹µ í›„ì²˜ë¦¬"
        Raw["ğŸ“¦ API ì‘ë‹µ<br/>(ëŒ€ìš©ëŸ‰ JSON)"]
        Check{"í¬ê¸° ì²´í¬<br/>> 500 í† í°?"}
        PoT["ğŸ¤– ProgramOfThought<br/>Python ì½”ë“œ ìƒì„± â†’ ì‹¤í–‰"]
        Summary["ğŸ“‹ í•µì‹¬ ë°ì´í„°<br/>(~500 í† í°)"]
    end

    Raw --> Check
    Check -->|"ì‘ìŒ"| Summary
    Check -->|"í¼"| PoT
    PoT --> Summary
    Summary --> CTX["ReAct Context"]

    style Raw fill:#e74c3c,color:#fff
    style PoT fill:#9b59b6,color:#fff
    style Summary fill:#27ae60,color:#fff
        </div>

        <h4>ProgramOfThought vs Predict ë¹„êµ</h4>
        <table>
            <thead>
                <tr><th>ë¹„êµ í•­ëª©</th><th>Predict (LLM ìš”ì•½)</th><th>ProgramOfThought</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>ì •í™•ë„</strong></td><td>í• ë£¨ì‹œë„¤ì´ì…˜ ê°€ëŠ¥</td><td>ì½”ë“œ ì‹¤í–‰ì´ë¼ ì •í™•</td></tr>
                <tr><td><strong>ìˆ«ì ì²˜ë¦¬</strong></td><td>ì•½í•¨ (ê³„ì‚° ì˜¤ë¥˜)</td><td>ê°•í•¨ (Python ê³„ì‚°)</td></tr>
                <tr><td><strong>ëŒ€ìš©ëŸ‰ ì²˜ë¦¬</strong></td><td>í† í° ì œí•œ</td><td>JSON íŒŒì‹±ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥</td></tr>
                <tr><td><strong>ë¹„ìš©</strong></td><td>ì…ë ¥ í† í° ë¹„ìš© ë†’ìŒ</td><td>ì½”ë“œë§Œ ìƒì„± (ì €ë ´)</td></tr>
            </tbody>
        </table>

        <h4>êµ¬í˜„ ì˜ˆì‹œ</h4>
<pre><code>class DataExtractor(dspy.Signature):
    """ëŒ€ìš©ëŸ‰ API ì‘ë‹µì—ì„œ í•µì‹¬ ë°ì´í„° ì¶”ì¶œ"""
    query: str = dspy.InputField(desc="ì‚¬ìš©ì ì§ˆë¬¸")
    data_schema: str = dspy.InputField(desc="ë°ì´í„° êµ¬ì¡° ì„¤ëª…")
    code: str = dspy.OutputField(desc="Python ì¶”ì¶œ ì½”ë“œ")

MAX_CONTEXT_TOKENS = 500

def process_api_response(raw_response: dict, query: str) -> str:
    # 1. í¬ê¸° ì²´í¬
    response_str = json.dumps(raw_response, ensure_ascii=False)
    if estimate_tokens(response_str) <= MAX_CONTEXT_TOKENS:
        return response_str

    # 2. í¬ë©´ ProgramOfThoughtë¡œ ì¶”ì¶œ
    extractor = dspy.ProgramOfThought(DataExtractor)
    result = extractor(
        query=query,
        data_schema=describe_schema(raw_response)
    )

    # 3. ìƒì„±ëœ ì½”ë“œ ì‹¤í–‰
    extracted = exec_safe(result.code, {"data": raw_response})
    return json.dumps(extracted, ensure_ascii=False)</code></pre>

        <div class="section">
            <h4>ì™œ í´ë¼ì´ì–¸íŠ¸ê°€ ì•„ë‹Œ ì„œë²„ í›„ì²˜ë¦¬ì¸ê°€?</h4>
            <table>
                <thead>
                    <tr><th>í´ë¼ì´ì–¸íŠ¸ ì „ì²˜ë¦¬</th><th>ì„œë²„ í›„ì²˜ë¦¬ âœ…</th></tr>
                </thead>
                <tbody>
                    <tr><td>ë°ì´í„° íƒ€ì…ë³„ í‘œì¤€í™” í•„ìš”</td><td>LLMì´ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬</td></tr>
                    <tr><td>í´ë¼ì´ì–¸íŠ¸ë§ˆë‹¤ êµ¬í˜„ ë¶€ë‹´</td><td>ì¤‘ì•™ ì§‘ì¤‘ ê´€ë¦¬</td></tr>
                    <tr><td>ìœ ì§€ë³´ìˆ˜ ë¶„ì‚°</td><td>ì„œë²„ë§Œ ìˆ˜ì •</td></tr>
                </tbody>
            </table>
        </div>

        <hr>

        <!-- 7. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ -->
        <h2 id="test">7. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h2>

        <h3>7.1 ReAct Loop ê¸°ë³¸ ë™ì‘</h3>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Agent

    User->>Agent: "EC2ë€ ë¬´ì—‡ì¸ê°€ìš”?"
    Note over Agent: Thought: ì¼ë°˜ ì§€ì‹ ì§ˆë¬¸<br/>Action: finish
    Agent->>User: "EC2ëŠ” AWSì˜ ê°€ìƒ ì„œë²„..."
        </div>

        <table>
            <thead>
                <tr><th>ë‹¨ê³„</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>ì…ë ¥</strong></td><td>ë‹¨ìˆœ ì§€ì‹ ì§ˆë¬¸ (ë„êµ¬ ë¶ˆí•„ìš”)</td></tr>
                <tr><td><strong>ì¶”ë¡ </strong></td><td>1 stepë§Œì— finish ê²°ì •</td></tr>
                <tr><td><strong>ì¶œë ¥</strong></td><td>LLM ì§€ì‹ìœ¼ë¡œ ì§ì ‘ ë‹µë³€</td></tr>
            </tbody>
        </table>

        <h3>7.2 Human Feedback ì—°ë™</h3>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Agent
    participant Tool as ask_human

    User->>Agent: "ë¹„ìš© ì¤„ì—¬ì¤˜"
    Note over Agent: Thought: ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ì§€ ë¶ˆëª…í™•
    Agent->>Tool: ask_human("ì–´ë–¤ ì„œë¹„ìŠ¤?")
    Tool->>User: "ì–´ë–¤ ì„œë¹„ìŠ¤ì˜ ë¹„ìš©ì„ ì¤„ì¼ê¹Œìš”?"
    User->>Tool: "EC2ìš”"
    Tool->>Agent: Observation: "EC2ìš”"
    Note over Agent: Thought: EC2 ë¹„ìš© ìµœì í™” ë°©ì•ˆ ì œì‹œ<br/>Action: finish
    Agent->>User: "EC2 ë¹„ìš© ìµœì í™” ë°©ì•ˆ..."
        </div>

        <table>
            <thead>
                <tr><th>ë‹¨ê³„</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>Step 1</strong></td><td>ëª¨í˜¸í•œ ì§ˆë¬¸ ê°ì§€ â†’ ask_human í˜¸ì¶œ</td></tr>
                <tr><td><strong>ì‚¬ìš©ì ì‘ë‹µ</strong></td><td>"EC2ìš”" ì…ë ¥</td></tr>
                <tr><td><strong>Step 2</strong></td><td>ëª…í™•í•´ì§„ ìš”ì²­ìœ¼ë¡œ finish</td></tr>
                <tr><td><strong>ì´ 2 steps</strong></td><td>Human Feedbackìœ¼ë¡œ ì§ˆë¬¸ ëª…í™•í™”</td></tr>
            </tbody>
        </table>

        <h3>7.3 API Request ì—°ë™</h3>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Agent
    participant Tool as request_api
    participant API

    User->>Agent: "ì´ë²ˆë‹¬ EC2 ë¹„ìš©ì´ ì™œ ì¦ê°€í–ˆì–´?"
    Note over Agent: Thought: ë¹„ìš© ë°ì´í„° í•„ìš”
    Agent->>Tool: request_api("ì´ë²ˆë‹¬ EC2 ë¹„ìš©")
    Tool->>API: GET /api/costs
    API->>Tool: {"nov": 10000, "dec": 15000}
    Tool->>Agent: Observation: ë¹„ìš© ë°ì´í„°
    Note over Agent: Thought: 50% ì¦ê°€, ì›ì¸ ë¶„ì„<br/>Action: finish
    Agent->>User: "EC2 ë¹„ìš©ì´ 50% ì¦ê°€í–ˆìŠµë‹ˆë‹¤..."
        </div>

        <table>
            <thead>
                <tr><th>ë‹¨ê³„</th><th>ì„¤ëª…</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>Step 1</strong></td><td>ë¹„ìš© ë°ì´í„° í•„ìš” íŒë‹¨ â†’ request_api í˜¸ì¶œ</td></tr>
                <tr><td><strong>API ì‘ë‹µ</strong></td><td>{"nov": 10000, "dec": 15000}</td></tr>
                <tr><td><strong>Step 2</strong></td><td>ë°ì´í„° ë¶„ì„ í›„ finish</td></tr>
                <tr><td><strong>ì´ 2 steps</strong></td><td>API ë°ì´í„° ê¸°ë°˜ ë¶„ì„ ë‹µë³€</td></tr>
            </tbody>
        </table>

    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#0f3460',
                primaryTextColor: '#eaeaea',
                primaryBorderColor: '#30363d',
                lineColor: '#00d9ff',
                secondaryColor: '#16213e',
                tertiaryColor: '#1a1a2e'
            }
        });

        // ëª¨ë“  Mermaid ë‹¤ì´ì–´ê·¸ë¨ ë…¸ë“œ í­ í™•ì¥
        window.addEventListener('load', function() {
            setTimeout(function() {
                const diagrams = document.querySelectorAll('.mermaid svg');
                diagrams.forEach(diagram => {
                    const foreignObjects = diagram.querySelectorAll('foreignObject');
                    foreignObjects.forEach(fo => {
                        const currentWidth = parseInt(fo.getAttribute('width')) || 150;
                        fo.setAttribute('width', Math.max(currentWidth * 1.5, 250));
                    });
                });
            }, 500);
        });
    </script>
</body>
</html>
