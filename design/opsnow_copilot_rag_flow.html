<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpsNow Copilot - Unified Context Flow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .section-title {
            color: #00d4ff;
            font-size: 1.3rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title .num {
            background: #00d4ff;
            color: #1a1a2e;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .mermaid {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        .card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .card-title {
            color: #ffd700;
            font-size: 1.1rem;
            margin-bottom: 12px;
        }
        .card ul {
            list-style: none;
            padding-left: 0;
        }
        .card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .card li:last-child {
            border-bottom: none;
        }
        .card li::before {
            content: "â†’";
            color: #00d4ff;
        }
        .highlight {
            color: #00d4ff;
            font-weight: 600;
        }
        .tag {
            display: inline-block;
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin: 2px;
        }
        .tag.yellow {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        .tag.green {
            background: rgba(0, 255, 128, 0.2);
            color: #00ff80;
        }
        .tag.red {
            background: rgba(255, 100, 100, 0.2);
            color: #ff6464;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        th {
            color: #00d4ff;
            font-weight: 600;
        }
        .cost {
            color: #00ff80;
            font-weight: bold;
        }
        .flow-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .flow-step .step-num {
            background: #00d4ff;
            color: #1a1a2e;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            flex-shrink: 0;
        }
        .redis-key {
            font-family: monospace;
            background: rgba(255, 215, 0, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            color: #ffd700;
        }
        .json-block {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 16px;
            font-family: monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            white-space: pre;
            color: #b0b0b0;
        }
        .json-key { color: #00d4ff; }
        .json-string { color: #98c379; }
        .json-number { color: #d19a66; }
        .formula {
            background: rgba(0, 212, 255, 0.1);
            border-left: 4px solid #00d4ff;
            padding: 16px;
            border-radius: 0 8px 8px 0;
            font-family: monospace;
            font-size: 1.1rem;
            margin: 16px 0;
        }
        .footer {
            text-align: center;
            color: #666;
            margin-top: 40px;
            padding: 20px;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>OpsNow Copilot - Unified Context Flow</h1>
        <p class="subtitle">Recursive Summarization + Agentic RAG í†µí•© ì•„í‚¤í…ì²˜ (v0.4)</p>

        <!-- 1. ì „ì²´ ì•„í‚¤í…ì²˜ -->
        <div class="section">
            <h2 class="section-title"><span class="num">1</span> ì „ì²´ ì•„í‚¤í…ì²˜</h2>
            <div class="mermaid">
flowchart TB
    subgraph Input["ì…ë ¥"]
        Q["ì‚¬ìš©ì ì§ˆë¬¸<br/>'EC2 ë¹„ìš© ì¤„ì´ëŠ” ë°©ë²•?'"]
    end

    subgraph Parallel["ë³‘ë ¬ ì‹¤í–‰"]
        Q --> MEM["Long-term Memory<br/>(íˆìŠ¤í† ë¦¬)"]
        Q --> RAG["Agentic RAG<br/>(FAQ/Guide)"]
    end

    subgraph Memory["Long-term Memory (Redis Only)"]
        MEM --> SHORT["ë‹¨ê¸°ê¸°ì–µ<br/>ìµœê·¼ 5í„´ ì›ë³¸"]
        MEM --> RSUM["Long-term Memory<br/>ì „ì²´ ë§¥ë½ ~500í† í°"]
        MEM --> ENT["Entities<br/>êµ¬ì¡°í™” ì •ë³´"]
    end

    subgraph RAGFlow["Agentic RAG (FAISS)"]
        RAG --> SEARCH["search_all<br/>FAQ 3 + Guide 7"]
        SEARCH --> RERANK["Rerank + ì¶©ë¶„ì„±"]
        RERANK -->|ë¶€ì¡±| RETRY["ì¬ê²€ìƒ‰/ì„¹ì…˜í™•ì¥"]
        RETRY --> RERANK
        RERANK -->|ì¶©ë¶„| RAGRES["RAG ê²°ê³¼"]
    end

    subgraph Merge["ê²°ê³¼ ë³‘í•©"]
        SHORT --> CTX["Context Builder"]
        RSUM --> CTX
        ENT --> CTX
        RAGRES --> CTX
    end

    subgraph Fallback["Fallback"]
        CTX --> CHK{"confidence<br/>< 0.5?"}
        CHK -->|Yes| MENU["ë©”ë‰´ ê²€ìƒ‰<br/>(ì¸ë©”ëª¨ë¦¬)"]
        MENU --> FB["Fallback ì‘ë‹µ"]
        CHK -->|No| GEN["ì‘ë‹µ ìƒì„±"]
    end

    subgraph Output["ì¶œë ¥"]
        FB --> RESP["ìµœì¢… ì‘ë‹µ"]
        GEN --> RESP
    end

    subgraph Post["í›„ì²˜ë¦¬ (ë¹„ë™ê¸°)"]
        RESP -.-> SAVE["í„´ ì €ì¥"]
        SAVE -.-> OVF{"ë‹¨ê¸° > 5í„´?"}
        OVF -.->|Yes| UPDATE["Memory Update<br/>Mi = LLM(Mi-1, Si)"]
    end

    style Q fill:#00d4ff,color:#000
    style RESP fill:#00ff80,color:#000
    style UPDATE fill:#ffd700,color:#000
    style MENU fill:#ff9800,color:#000
            </div>
        </div>

        <!-- 2. Long-term Memory -->
        <div class="section">
            <h2 class="section-title"><span class="num">2</span> Long-term Memory - Recursive Summarization</h2>

            <div class="formula">
                Mi = LLM(Mi-1, Si) â†’ ë©”ëª¨ë¦¬ëŠ” ë¡œê·¸ê°€ ì•„ë‹ˆë¼ <strong>ìƒíƒœ(State)</strong>ë‹¤
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">Read Flow (ê²€ìƒ‰ ì—†ìŒ)</h3>
                    <div class="flow-step">
                        <span class="step-num">1</span>
                        <span>Redisì—ì„œ <span class="highlight">ì „ì²´ ë©”ëª¨ë¦¬</span> ì¡°íšŒ</span>
                    </div>
                    <div class="flow-step">
                        <span class="step-num">2</span>
                        <span>ë‹¨ê¸°ê¸°ì–µ + Long-term Memory + Entities ë°˜í™˜</span>
                    </div>
                    <div class="flow-step">
                        <span class="step-num">3</span>
                        <span><span class="highlight">ê²€ìƒ‰/ë§¤ì¹­ ì—†ìŒ</span> â†’ noise ì œê±°</span>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Write Flow (Memory Update)</h3>
                    <div class="flow-step">
                        <span class="step-num">1</span>
                        <span>ë‹¨ê¸° > 5í„´ â†’ 5í„´ ì¶”ì¶œ</span>
                    </div>
                    <div class="flow-step">
                        <span class="step-num">2</span>
                        <span><span class="highlight">ì´ì „ ë©”ëª¨ë¦¬ + ìƒˆ ëŒ€í™”</span> â†’ LLM</span>
                    </div>
                    <div class="flow-step">
                        <span class="step-num">3</span>
                        <span>ìƒˆ ë©”ëª¨ë¦¬ë¡œ <span class="highlight">ë®ì–´ì“°ê¸°</span></span>
                    </div>
                    <div class="flow-step">
                        <span class="step-num">4</span>
                        <span>Entities ë³‘í•©</span>
                    </div>
                </div>
            </div>

            <div class="mermaid" style="margin-top: 20px;">
flowchart LR
    subgraph Read["Read (ê²€ìƒ‰ ì—†ìŒ)"]
        Q1["ì§ˆë¬¸"] --> GET["Redis ì¡°íšŒ"]
        GET --> S["ë‹¨ê¸° 5í„´"]
        GET --> M["Long-term Memory"]
        GET --> E["Entities"]
    end

    subgraph Write["Write (Memory Update)"]
        TURNS["5í„´ ëŒ€í™”"] --> COMBINE["ì´ì „ ë©”ëª¨ë¦¬ +<br/>ìƒˆ ëŒ€í™”"]
        COMBINE --> LLM["LLM ì¬ìš”ì•½"]
        LLM --> OVERWRITE["ë®ì–´ì“°ê¸°"]
    end

    style GET fill:#00d4ff,color:#000
    style LLM fill:#ffd700,color:#000
    style OVERWRITE fill:#00ff80,color:#000
            </div>

            <!-- ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ -->
            <div class="card" style="margin-top: 20px;">
                <h3 class="card-title">ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ: ì•”ë¬µì  ì°¸ì¡° ì²˜ë¦¬</h3>
                <div class="mermaid">
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant C as Copilot
    participant M as Long-term Memory

    Note over U,M: í„´ 1-5 (ë‹¨ê¸°ê¸°ì–µ)
    U->>C: "11ì›” AWS ë¹„ìš© ë¶„ì„í•´ì¤˜"
    C->>U: "11ì›” ì´ ë¹„ìš© $12,500. EC2 65%..."

    Note over U,M: í„´ 6ì—ì„œ Memory Update ë°œìƒ
    C->>M: Mi = LLM(Mi-1, "11ì›” AWS ë¶„ì„...")
    M-->>M: "ì‚¬ìš©ìê°€ 11ì›” AWS ë¹„ìš© ë¶„ì„ ìš”ì²­.<br/>ì´ $12,500, EC2ê°€ 65% ì°¨ì§€"

    Note over U,M: í„´ 10 (ë‹¨ê¸°ê¸°ì–µ ë°–)
    U->>C: "1ì›”ì€?"

    Note over C: í‚¤ì›Œë“œ "1ì›”" â‰  "11ì›”"<br/>But ì „ì²´ ë§¥ë½ì—ì„œ ìœ ì¶” ê°€ëŠ¥
    C->>M: ì „ì²´ ë©”ëª¨ë¦¬ ì¡°íšŒ (ê²€ìƒ‰ X)
    M-->>C: "ì‚¬ìš©ìê°€ 11ì›” AWS ë¹„ìš© ë¶„ì„..."
    C->>U: "1ì›” AWS ì´ ë¹„ìš©ì€ $11,200..."
                </div>
                <div class="grid-2" style="margin-top: 16px;">
                    <div class="card" style="background: rgba(255, 100, 100, 0.1); border: 1px solid rgba(255, 100, 100, 0.3);">
                        <h4 style="color: #ff6464; margin-bottom: 8px;">âŒ Fact ê²€ìƒ‰ ë°©ì‹</h4>
                        <p style="font-size: 0.9rem;">"1ì›”" í‚¤ì›Œë“œë¡œ ê²€ìƒ‰ â†’ "11ì›”" fact ëª» ì°¾ìŒ</p>
                        <p style="font-size: 0.85rem; color: #888; margin-top: 8px;">í‚¤ì›Œë“œ ë¶ˆì¼ì¹˜ = ê²€ìƒ‰ ì‹¤íŒ¨</p>
                    </div>
                    <div class="card" style="background: rgba(0, 255, 128, 0.1); border: 1px solid rgba(0, 255, 128, 0.3);">
                        <h4 style="color: #00ff80; margin-bottom: 8px;">âœ… Recursive Summarization</h4>
                        <p style="font-size: 0.9rem;">ì „ì²´ ë§¥ë½ì—ì„œ LLMì´ "11ì›”ì²˜ëŸ¼ 1ì›”ë„" ìœ ì¶”</p>
                        <p style="font-size: 0.85rem; color: #888; margin-top: 8px;">ê²€ìƒ‰ ì—†ìŒ = ë§¥ë½ ì†ì‹¤ ì—†ìŒ</p>
                    </div>
                </div>
            </div>

            <!-- ë©”ëª¨ë¦¬ ë³´ì •: í”„ë¡¬í”„íŠ¸ íŠœë‹ -->
            <div class="card" style="margin-top: 20px;">
                <h3 class="card-title">ë©”ëª¨ë¦¬ ë³´ì •: Recency ìš°ì„  í”„ë¡¬í”„íŠ¸</h3>
                <p style="margin-bottom: 12px; color: #aaa;">ì˜¤ë˜ëœ ì •ë³´ê°€ ê³„ì† ìŒ“ì´ëŠ” ë¬¸ì œ â†’ ìš”ì•½ ì‹œ í”„ë¡¬í”„íŠ¸ë¡œ ë³´ì • (Memory + Entities ë™ì‹œ ì •ë¦¬)</p>
                <div class="json-block" style="font-size: 0.8rem;">
<span style="color: #ff6464;"># Memory Update Prompt</span>

ë‹¹ì‹ ì€ ëŒ€í™” ìš”ì•½ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

<span style="color: #ffd700;">## ì…ë ¥</span>
- ì´ì „ ë©”ëª¨ë¦¬: {previous_memory}
- ì´ì „ Entities: {previous_entities}
- ìƒˆ ëŒ€í™” (5í„´): {new_dialogue}

<span style="color: #ffd700;">## Long-term Memory ê·œì¹™</span>
1. <span style="color: #00ff80;">ìµœê·¼ ëŒ€í™” ìš°ì„ </span>: ìƒˆ ëŒ€í™” ë‚´ìš©ì´ ë” ì¤‘ìš”
2. <span style="color: #00ff80;">ì£¼ì œ ì „í™˜ ê°ì§€</span>: ì£¼ì œê°€ ë°”ë€Œë©´ ì´ì „ ì£¼ì œëŠ” í•œ ì¤„ë¡œ ì••ì¶•
3. <span style="color: #00ff80;">ì˜¤ë˜ëœ ì •ë³´ ì •ë¦¬</span>: ë” ì´ìƒ ê´€ë ¨ ì—†ëŠ” ë‚´ìš©ì€ ê³¼ê°íˆ ì‚­ì œ

<span style="color: #ffd700;">## Entities ê·œì¹™</span>
1. <span style="color: #00ff80;">ê°™ì€ í‚¤ëŠ” ë®ì–´ì“°ê¸°</span>: ê°’ì´ ë°”ë€Œë©´ ìµœì‹  ê°’ìœ¼ë¡œ
2. <span style="color: #00ff80;">ìµœëŒ€ 25ê°œ ì œí•œ (FIFO)</span>: ì´ˆê³¼ ì‹œ ì˜¤ë˜ëœ ê²ƒë¶€í„° ì‚­ì œ
3. <span style="color: #00ff80;">ì£¼ì œ ë°”ë€Œì–´ë„ ìœ ì§€</span>: ìì—°ìŠ¤ëŸ½ê²Œ ë°€ë ¤ë‚  ë•Œê¹Œì§€ ë³´ì¡´

<span style="color: #ffd700;">## ì¶œë ¥</span>
- ìƒˆ ë©”ëª¨ë¦¬ (ìµœëŒ€ 20ë¬¸ì¥)
- ìƒˆ Entities (ìµœëŒ€ 25ê°œ, FIFO)
                </div>
                <div class="grid-2" style="margin-top: 16px;">
                    <div class="card" style="background: rgba(0, 0, 0, 0.2);">
                        <h4 style="color: #ffd700; margin-bottom: 8px;">ì˜ˆì‹œ: ì£¼ì œ ì „í™˜ ì‹œ Memory</h4>
                        <p style="font-size: 0.85rem; color: #aaa;">Before:</p>
                        <p style="font-size: 0.85rem;">"11ì›” AWS ë¹„ìš© $12,500 ë¶„ì„í•¨. EC2ê°€ 65%..."</p>
                        <p style="font-size: 0.85rem; color: #aaa; margin-top: 8px;">After (ì£¼ì œ ë°”ë€œ):</p>
                        <p style="font-size: 0.85rem;">"ì´ì „ì— 11ì›” ë¹„ìš© ë¶„ì„í•¨. <span style="color: #00ff80;">í˜„ì¬ëŠ” ì‚¬ìš©ì ê¶Œí•œ ì„¤ì • ì¤‘</span>..."</p>
                    </div>
                    <div class="card" style="background: rgba(0, 0, 0, 0.2);">
                        <h4 style="color: #ffd700; margin-bottom: 8px;">ì˜ˆì‹œ: Entities FIFO</h4>
                        <p style="font-size: 0.85rem; color: #aaa;">ë°°ì—´ + í„´ ë²ˆí˜¸ë¡œ ìˆœì„œ ê´€ë¦¬:</p>
                        <div class="json-block" style="font-size: 0.7rem; margin-top: 4px;">[{<span class="json-key">"key"</span>:<span class="json-string">"nov_cost"</span>, <span class="json-key">"turn"</span>:<span class="json-number">3</span>}, {<span class="json-key">"key"</span>:<span class="json-string">"topic"</span>, <span class="json-key">"turn"</span>:<span class="json-number">10</span>}, ...]</div>
                        <p style="font-size: 0.85rem; color: #aaa; margin-top: 8px;">25ê°œ ì´ˆê³¼ ì‹œ ì•ì—ì„œ shift:</p>
                        <div class="json-block" style="font-size: 0.7rem; margin-top: 4px;">[{<span class="json-key">"key"</span>:<span class="json-string">"topic"</span>, <span class="json-key">"turn"</span>:<span class="json-number">10</span>}, ...ìƒˆê²ƒë“¤...]</div>
                        <p style="font-size: 0.85rem; color: #00ff80; margin-top: 8px;">â†’ turn:3ì¸ nov_cost ìì—°ìŠ¤ëŸ½ê²Œ íƒˆë½</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Redis ì €ì¥ êµ¬ì¡° -->
        <div class="section">
            <h2 class="section-title"><span class="num">3</span> Redis ì €ì¥ êµ¬ì¡°</h2>
            <div class="grid-3">
                <div class="card">
                    <h3 class="card-title">ë‹¨ê¸°ê¸°ì–µ</h3>
                    <p style="margin-bottom: 8px; color: #00d4ff; font-size: 0.9rem;">ğŸ“Œ ìš©ë„: "ì•„ê¹Œ ê·¸ê±°" ì •í™•íˆ ì°¾ê¸°</p>
                    <p style="margin-bottom: 8px; font-size: 0.85rem; color: #aaa;">ìµœê·¼ 5í„´ ì›ë³¸ ê·¸ëŒ€ë¡œ ì €ì¥. ìˆ˜ì •/ìš”ì•½ ì—†ì´ ê·¸ëŒ€ë¡œ LLMì— ì „ë‹¬</p>
                    <p style="margin-bottom: 12px;">Key: <span class="redis-key">chat:{tenant}:{session}:short</span></p>
                    <div class="json-block" style="font-size: 0.75rem;">[
  {
    <span class="json-key">"turn"</span>: <span class="json-number">6</span>,
    <span class="json-key">"user"</span>: <span class="json-string">"11ì›” AWS ë¹„ìš©?"</span>,
    <span class="json-key">"assistant"</span>: <span class="json-string">"$12,500"</span>
  }
]</div>
                </div>
                <div class="card">
                    <h3 class="card-title">Long-term Memory</h3>
                    <p style="margin-bottom: 8px; color: #00d4ff; font-size: 0.9rem;">ğŸ“Œ ìš©ë„: ì „ì²´ ëŒ€í™” ë§¥ë½ ìœ ì§€</p>
                    <p style="margin-bottom: 8px; font-size: 0.85rem; color: #aaa;">5í„´ ë„˜ì–´ê°„ ëŒ€í™”ë¥¼ ìš”ì•½í•´ì„œ ì €ì¥. "ë­í•˜ë˜ ì¤‘ì´ì—ˆì§€?" íŒŒì•…ìš©</p>
                    <p style="margin-bottom: 12px;">Key: <span class="redis-key">chat:{tenant}:{session}:memory</span></p>
                    <div class="json-block" style="font-size: 0.75rem;">{
  <span class="json-key">"content"</span>: <span class="json-string">"ì‚¬ìš©ìëŠ” AWS ë¹„ìš© ë¶„ì„ ì¤‘. EC2ê°€ 65%..."</span>,
  <span class="json-key">"version"</span>: <span class="json-number">3</span>
}</div>
                </div>
                <div class="card">
                    <h3 class="card-title">Entities</h3>
                    <p style="margin-bottom: 8px; color: #00d4ff; font-size: 0.9rem;">ğŸ“Œ ìš©ë„: í•µì‹¬ ìˆ«ì/í‚¤ì›Œë“œ ë³´ì¡´</p>
                    <p style="margin-bottom: 8px; font-size: 0.85rem; color: #aaa;">ìš”ì•½í•˜ë©´ ë‚ ì•„ê°€ëŠ” ì •í™•í•œ ìˆ˜ì¹˜ë“¤. ë°°ì—´ + í„´ ë²ˆí˜¸ë¡œ FIFO ê´€ë¦¬</p>
                    <p style="margin-bottom: 12px;">Key: <span class="redis-key">chat:{tenant}:{session}:entities</span></p>
                    <div class="json-block" style="font-size: 0.75rem;">[
  {<span class="json-key">"key"</span>: <span class="json-string">"provider"</span>, <span class="json-key">"value"</span>: <span class="json-string">"aws"</span>, <span class="json-key">"turn"</span>: <span class="json-number">3</span>},
  {<span class="json-key">"key"</span>: <span class="json-string">"budget"</span>, <span class="json-key">"value"</span>: <span class="json-string">"$10,000"</span>, <span class="json-key">"turn"</span>: <span class="json-number">5</span>},
  {<span class="json-key">"key"</span>: <span class="json-string">"top_service"</span>, <span class="json-key">"value"</span>: <span class="json-string">"ec2"</span>, <span class="json-key">"turn"</span>: <span class="json-number">7</span>}
]</div>
                </div>
            </div>

            <!-- Long-term Memory vs Entities ë¹„êµ -->
            <div class="card" style="margin-top: 20px;">
                <h3 class="card-title">Long-term Memory vs Entities ì°¨ì´ì </h3>
                <table>
                    <tr>
                        <th>êµ¬ë¶„</th>
                        <th>Long-term Memory</th>
                        <th>Entities</th>
                    </tr>
                    <tr>
                        <td>í˜•íƒœ</td>
                        <td>ìì—°ì–´ ë¬¸ì¥</td>
                        <td>key-value êµ¬ì¡°</td>
                    </tr>
                    <tr>
                        <td>ë‚´ìš©</td>
                        <td>"ì‚¬ìš©ìê°€ ë­˜ í•˜ê³  ìˆì—ˆëŠ”ì§€" ë§¥ë½</td>
                        <td>ì •í™•í•œ ìˆ«ì, ì´ë¦„, í‚¤ì›Œë“œ</td>
                    </tr>
                    <tr>
                        <td>ì™œ ë¶„ë¦¬?</td>
                        <td>ìš”ì•½í•˜ë©´ íë¦„ì€ ìœ ì§€ë˜ì§€ë§Œ...</td>
                        <td>ìˆ«ìëŠ” ìš”ì•½í•˜ë©´ ë‚ ì•„ê°! (ë³„ë„ ë³´ì¡´)</td>
                    </tr>
                    <tr>
                        <td><strong>ê²€ìƒ‰ ë°©ì‹</strong></td>
                        <td class="cost"><strong>ê²€ìƒ‰ ì•ˆí•¨</strong> - í•­ìƒ ì „ì²´ í¬í•¨</td>
                        <td class="cost"><strong>ê²€ìƒ‰ ì•ˆí•¨</strong> - í•­ìƒ ì „ì²´ í¬í•¨</td>
                    </tr>
                </table>
                <div class="formula" style="margin-top: 16px;">
                    <strong>í•µì‹¬:</strong> ë‘˜ ë‹¤ <span style="color: #00ff80;">ê²€ìƒ‰/ë§¤ì¹­ ì—†ì´</span> ë§¤ë²ˆ LLMì— í†µì§¸ë¡œ ì „ë‹¬ë¨ â†’ <span style="color: #00ff80;">ê²€ìƒ‰ ì‹¤íŒ¨ ì—†ìŒ</span>
                </div>
            </div>

            <!-- ì‹¤ì œ LLMì— ì „ë‹¬ë˜ëŠ” í˜•íƒœ -->
            <div class="card" style="margin-top: 20px;">
                <h3 class="card-title">ì‹¤ì œ LLM Contextì— ë“¤ì–´ê°€ëŠ” í˜•íƒœ</h3>
                <div class="json-block" style="font-size: 0.8rem;">
<span style="color: #ff6464;"># System Prompt</span>
ë‹¹ì‹ ì€ FinOps AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤...

<span style="color: #ffd700;"># Long-term Memory (ë§¥ë½)</span>
[ì´ì „ ëŒ€í™” ìš”ì•½]
ì‚¬ìš©ìëŠ” AWS 11ì›” ë¹„ìš©ì„ ë¶„ì„ ì¤‘ì´ë‹¤. EC2ê°€ ì „ì²´ì˜ 65%ë¥¼ ì°¨ì§€í•˜ë©°,
ì˜ˆì‚° $10,000 ëŒ€ë¹„ ì´ˆê³¼ ìƒíƒœ. RI ì „í™˜ì„ ê²€í† í•˜ê¸°ë¡œ í–ˆë‹¤.

<span style="color: #ffd700;"># Entities (ì •í™•í•œ ìˆ˜ì¹˜, ë°°ì—´ì—ì„œ ì¶”ì¶œ)</span>
- provider: aws (turn 3)
- month: 11ì›” (turn 4)
- total_cost: $12,500 (turn 5)
- budget: $10,000 (turn 5)
- top_service: ec2, 65% (turn 7)

<span style="color: #00d4ff;"># ë‹¨ê¸°ê¸°ì–µ (ìµœê·¼ 5í„´ ì›ë³¸)</span>
[í„´6] User: "ê·¸ëŸ¼ RI ì „í™˜í•˜ë©´ ì–¼ë§ˆë‚˜ ì ˆê°ë¼?"
[í„´6] Assistant: "EC2 RI 1ë…„ ì•½ì • ì‹œ ì•½ 30% ì ˆê°..."
...

<span style="color: #00ff80;"># í˜„ì¬ ì§ˆë¬¸</span>
User: "1ì›”ì€?"
                </div>
                <p style="margin-top: 12px; color: #aaa; font-size: 0.85rem;">
                    â†’ LLMì´ ìœ„ ì „ì²´ ë§¥ë½ì„ ë³´ê³  "ì•„, 11ì›”ì²˜ëŸ¼ 1ì›” ë¹„ìš©ë„ ë¶„ì„í•´ë‹¬ë¼ëŠ” ê±°êµ¬ë‚˜" ìœ ì¶”
                </p>
            </div>

            </div>

        <!-- 4. Agentic RAG Flow -->
        <div class="section">
            <h2 class="section-title"><span class="num">4</span> Agentic RAG - FAQ/Guide ê²€ìƒ‰</h2>
            <div class="mermaid">
flowchart LR
    Q["Query"] --> SEARCH["search_all"]

    subgraph SearchAll["search_all"]
        FAQ["FAQ ê²€ìƒ‰<br/>k=3"]
        GUIDE["Guide ê²€ìƒ‰<br/>k=7"]
    end

    SEARCH --> FAQ
    SEARCH --> GUIDE
    FAQ --> MERGE["í•©ì¹˜ê¸°"]
    GUIDE --> MERGE
    MERGE --> RERANK["Rerank +<br/>ì¶©ë¶„ì„± í‰ê°€"]

    RERANK -->|"is_sufficient=true"| GEN["ì‘ë‹µ ìƒì„±"]
    RERANK -->|"next_action=search_again"| RETRY["refined_queryë¡œ<br/>ì¬ê²€ìƒ‰"]
    RERANK -->|"next_action=get_section"| EXPAND["ì„¹ì…˜ í™•ì¥"]

    RETRY --> SEARCH
    EXPAND --> RERANK

    RERANK -->|"3íšŒ ì´ˆê³¼"| FALLBACK["Fallback"]

    style Q fill:#00d4ff,color:#000
    style GEN fill:#00ff80,color:#000
    style FALLBACK fill:#ff6464,color:#000
            </div>
            <div class="grid-2" style="margin-top: 20px;">
                <div class="card">
                    <h3 class="card-title">Tools (3ê°œ)</h3>
                    <ul>
                        <li><span class="highlight">search_all</span> - FAQ 3ê°œ + Guide 7ê°œ í†µí•© ê²€ìƒ‰</li>
                        <li><span class="highlight">search_by_metadata</span> - doc_type, has_steps ë“± í•„í„°</li>
                        <li><span class="highlight">get_section</span> - ë¬¸ì„œ ì„¹ì…˜ ì „ì²´ ê°€ì ¸ì˜¤ê¸°</li>
                    </ul>
                </div>
                <div class="card">
                    <h3 class="card-title">Self-Reflective Loop</h3>
                    <ul>
                        <li>Rerank + ì¶©ë¶„ì„± í‰ê°€ë¥¼ <span class="highlight">1íšŒ LLM í˜¸ì¶œ</span>ë¡œ í†µí•©</li>
                        <li>ë¶€ì¡±í•˜ë©´ <span class="highlight">refined_query</span>ë¡œ ì¬ê²€ìƒ‰</li>
                        <li>ìµœëŒ€ <span class="highlight">3íšŒ</span> tool call í›„ Fallback</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 5. Context Builder -->
        <div class="section">
            <h2 class="section-title"><span class="num">5</span> Context Builder - LLM ì…ë ¥ êµ¬ì„±</h2>
            <div class="mermaid">
flowchart TB
    subgraph Sources["ì •ë³´ ì†ŒìŠ¤"]
        S1["System Prompt<br/>~1500 í† í°"]
        S2["Long-term Memory<br/>~500 í† í°"]
        S3["Entities<br/>~200 í† í°"]
        S4["ë‹¨ê¸°ê¸°ì–µ<br/>~1500 í† í°"]
        S5["FAQ/Guide RAG<br/>~1500 í† í°"]
        S6["í˜„ì¬ ì§ˆë¬¸<br/>~100 í† í°"]
    end

    subgraph Build["Context Builder"]
        S1 --> CTX["LLM Context"]
        S2 --> CTX
        S3 --> CTX
        S4 --> CTX
        S5 --> CTX
        S6 --> CTX
    end

    CTX --> TOTAL["ì´ ~5,300 í† í°"]

    style TOTAL fill:#00d4ff,color:#000
            </div>
            <table style="margin-top: 20px;">
                <tr>
                    <th>ì†ŒìŠ¤</th>
                    <th>í† í°</th>
                    <th>ì¡°ê±´</th>
                    <th>ì„¤ëª…</th>
                </tr>
                <tr>
                    <td>System Prompt</td>
                    <td>~1500</td>
                    <td>í•­ìƒ</td>
                    <td>ì—­í•  + ê·œì¹™ + ë„êµ¬ ì„¤ëª…</td>
                </tr>
                <tr>
                    <td>Long-term Memory</td>
                    <td>~500</td>
                    <td>í•­ìƒ</td>
                    <td>ì „ì²´ ë§¥ë½ (ê³ ì •)</td>
                </tr>
                <tr>
                    <td>Entities</td>
                    <td>~200</td>
                    <td>í•­ìƒ</td>
                    <td>êµ¬ì¡°í™” ì •ë³´ (key-value)</td>
                </tr>
                <tr>
                    <td>ë‹¨ê¸°ê¸°ì–µ</td>
                    <td>~1500</td>
                    <td>í•­ìƒ</td>
                    <td>5í„´ Ã— í„´ë‹¹ ~300</td>
                </tr>
                <tr>
                    <td>FAQ/Guide</td>
                    <td>~1500</td>
                    <td>í•­ìƒ</td>
                    <td>Agentic RAG ê²°ê³¼</td>
                </tr>
                <tr>
                    <td>í˜„ì¬ ì§ˆë¬¸</td>
                    <td>~100</td>
                    <td>í•­ìƒ</td>
                    <td>ì‚¬ìš©ì ì…ë ¥</td>
                </tr>
            </table>
        </div>

        <!-- 6. ë©”ë‰´ Fallback -->
        <div class="section">
            <h2 class="section-title"><span class="num">6</span> ë©”ë‰´ Fallback (ì¸ë©”ëª¨ë¦¬)</h2>
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">ì–¸ì œ ì‹¤í–‰?</h3>
                    <ul>
                        <li>RAG <span class="highlight">confidence &lt; 0.5</span></li>
                        <li>RAG ê²°ê³¼ê°€ <span class="highlight">ë¹„ì–´ìˆìŒ</span></li>
                        <li>ì‘ë‹µ ìƒì„± <span class="highlight">ì‹¤íŒ¨</span></li>
                    </ul>
                </div>
                <div class="card">
                    <h3 class="card-title">ë°ì´í„° êµ¬ì¡°</h3>
                    <div class="json-block" style="font-size: 0.8rem;">{
  <span class="json-key">"menu_id"</span>: <span class="json-string">"budget_alert"</span>,
  <span class="json-key">"name"</span>: <span class="json-string">"Budget Alert"</span>,
  <span class="json-key">"url"</span>: <span class="json-string">"/cost/budget/alert"</span>,
  <span class="json-key">"keywords"</span>: [<span class="json-string">"ì˜ˆì‚°"</span>, <span class="json-string">"ì•Œë¦¼"</span>]
}</div>
                </div>
            </div>
        </div>

        <!-- 7. ë¹„ìš© -->
        <div class="section">
            <h2 class="section-title"><span class="num">7</span> ë¹„ìš© ë¶„ì„</h2>
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">Long-term Memory (gpt-5-nano)</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 8px;">ê¸°ì¤€: 300í† í°/í„´</p>
                    <table>
                        <tr>
                            <th>í•­ëª©</th>
                            <th>ë¹„ìš©</th>
                        </tr>
                        <tr>
                            <td>ì¬ê·€ ìš”ì•½ (5í„´ë§ˆë‹¤)</td>
                            <td class="cost">~$0.0003</td>
                        </tr>
                        <tr>
                            <td>100í„´ ëŒ€í™”</td>
                            <td class="cost">~$0.006</td>
                        </tr>
                    </table>
                </div>
                <div class="card">
                    <h3 class="card-title">Agentic RAG</h3>
                    <table>
                        <tr>
                            <th>í•­ëª©</th>
                            <th>ë¹„ìš©</th>
                        </tr>
                        <tr>
                            <td>Rerank + ì¶©ë¶„ì„± (1~2íšŒ)</td>
                            <td class="cost">$0.0003</td>
                        </tr>
                        <tr>
                            <td>Agent ì‘ë‹µ ìƒì„±</td>
                            <td class="cost">$0.00055</td>
                        </tr>
                        <tr>
                            <td>ì¿¼ë¦¬ë‹¹ í‰ê· </td>
                            <td class="cost">~$0.00115</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="card" style="margin-top: 20px;">
                <h3 class="card-title">ì›”ê°„ ë¹„ìš© ì¶”ì • (1,000 ì„¸ì…˜/ì¼, 300í† í°/í„´)</h3>
                <table>
                    <tr>
                        <th>ì‹œë‚˜ë¦¬ì˜¤</th>
                        <th>í„´/ì„¸ì…˜</th>
                        <th>Memory Update</th>
                        <th>Agentic RAG</th>
                        <th>ì´í•©</th>
                    </tr>
                    <tr>
                        <td>ì¼ë°˜</td>
                        <td>20í„´</td>
                        <td>~$36/ì›”</td>
                        <td>~$690/ì›”</td>
                        <td class="cost">~$726/ì›”</td>
                    </tr>
                    <tr>
                        <td>ë¬´ê±°ìš´ ì‚¬ìš©</td>
                        <td>50í„´</td>
                        <td>~$90/ì›”</td>
                        <td>~$1,725/ì›”</td>
                        <td class="cost">~$1,815/ì›”</td>
                    </tr>
                    <tr>
                        <td><strong>ìµœëŒ€</strong></td>
                        <td><strong>100í„´</strong></td>
                        <td><strong>~$180/ì›”</strong></td>
                        <td><strong>~$3,450/ì›”</strong></td>
                        <td class="cost"><strong>~$3,630/ì›”</strong></td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- 8. ë°°ì¹˜ ì‘ì—… -->
        <div class="section">
            <h2 class="section-title"><span class="num">8</span> ë°°ì¹˜ ì‘ì—… (Daily Cleanup)</h2>
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">ì‹¤í–‰ ì¡°ê±´</h3>
                    <ul>
                        <li>ì‹¤í–‰ ì£¼ê¸°: <span class="highlight">ë§¤ì¼ 03:00 KST</span></li>
                        <li>ëŒ€ìƒ: <span class="highlight">24ì‹œê°„ ì´ìƒ ë¯¸ì‚¬ìš©</span> ì„¸ì…˜</li>
                        <li>TTL ë§Œë£Œ ì˜ˆì • í‚¤ ëª…ì‹œì  ì‚­ì œ</li>
                    </ul>
                </div>
                <div class="card">
                    <h3 class="card-title">ì‚­ì œ ëŒ€ìƒ</h3>
                    <ul>
                        <li><span class="redis-key">chat:{tenant}:{session}:short</span></li>
                        <li><span class="redis-key">chat:{tenant}:{session}:memory</span></li>
                        <li><span class="redis-key">chat:{tenant}:{session}:entities</span></li>
                    </ul>
                </div>
            </div>
            <div class="mermaid" style="margin-top: 20px;">
flowchart LR
    CRON["Cron<br/>03:00 KST"] --> SCAN["SCAN<br/>chat:*:*:short"]
    SCAN --> CHK{{"TTL â‰¤ 0?"}}
    CHK -->|Yes| DEL["DELETE<br/>short + memory + entities"]
    CHK -->|No| SKIP["Skip"]
    DEL --> NEXT["ë‹¤ìŒ í‚¤"]
    SKIP --> NEXT
    NEXT --> CHK

    style CRON fill:#ffd700,color:#000
    style DEL fill:#ff6464,color:#000
            </div>
        </div>

        <!-- 9. ì¸í”„ë¼ -->
        <div class="section">
            <h2 class="section-title"><span class="num">9</span> í•„ìš” ì¸í”„ë¼</h2>
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title" style="color: #00ff80;">í•„ìš”</h3>
                    <ul>
                        <li><span class="highlight">Redis</span> - íˆìŠ¤í† ë¦¬ (ë‹¨ê¸° + Long-term Memory + Entities)</li>
                        <li><span class="highlight">FAISS</span> - FAQ/Guide ë²¡í„° ê²€ìƒ‰ (In-Memory)</li>
                        <li><span class="highlight">LLM API</span> - ì‘ë‹µ ìƒì„±, ì¬ê·€ ìš”ì•½, Rerank</li>
                    </ul>
                </div>
                <div class="card">
                    <h3 class="card-title" style="color: #ff6464;">ë¶ˆí•„ìš”</h3>
                    <ul>
                        <li><span style="text-decoration: line-through; color: #666;">ë²¡í„° DB (íˆìŠ¤í† ë¦¬ìš©)</span> - Recursive Summarizationìœ¼ë¡œ ëŒ€ì²´</li>
                        <li><span style="text-decoration: line-through; color: #666;">ì„ë² ë”© API (íˆìŠ¤í† ë¦¬ìš©)</span> - ë¶ˆí•„ìš”</li>
                        <li><span style="text-decoration: line-through; color: #666;">íƒœê·¸ ì¸ë±ìŠ¤</span> - ê²€ìƒ‰ ì—†ìŒ</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 10. í•µì‹¬ í¬ì¸íŠ¸ -->
        <div class="section">
            <h2 class="section-title"><span class="num">10</span> Recursive Summarization í•µì‹¬ í¬ì¸íŠ¸</h2>
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title" style="color: #00ff80;">ì¥ì </h3>
                    <ul>
                        <li><span class="highlight">ê²€ìƒ‰ ë¶ˆí•„ìš”</span> â†’ noise ì—†ìŒ</li>
                        <li><span class="highlight">ì¼ê´€ì„± ìë™ ìœ ì§€</span> â†’ outdated ì •ë³´ ì œê±°</li>
                        <li><span class="highlight">í† í° íš¨ìœ¨</span> â†’ ~500í† í° ê³ ì •</li>
                        <li><span class="highlight">êµ¬í˜„ ë‹¨ìˆœ</span> â†’ íƒœê·¸/ë§í¬ ê´€ë¦¬ ë¶ˆí•„ìš”</li>
                        <li><span class="highlight">"ì•„ê¹Œ ê·¸ê±°"</span> â†’ ë§¥ë½ì—ì„œ í•´ê²°</li>
                    </ul>
                </div>
                <div class="card">
                    <h3 class="card-title" style="color: #ffd700;">í•œê³„ ë° ëŒ€ì‘</h3>
                    <ul>
                        <li><span class="tag red">ì„¸ë¶€ ì†ì‹¤</span> â†’ Entitiesë¡œ ë³´ì¡´</li>
                        <li><span class="tag red">ìš”ì•½ í’ˆì§ˆ</span> â†’ í”„ë¡¬í”„íŠ¸ íŠœë‹</li>
                        <li><span class="tag red">Hallucination</span> â†’ Entities êµì°¨ ê²€ì¦</li>
                    </ul>
                </div>
            </div>
            <div class="formula" style="margin-top: 20px; text-align: center;">
                "ë©”ëª¨ë¦¬ëŠ” ë¡œê·¸ê°€ ì•„ë‹ˆë¼ <strong>ìƒíƒœ</strong>ë‹¤" - arXiv:2308.15022
            </div>
        </div>

        <div class="footer">
            OpsNow Copilot - Unified Context Architecture v0.4<br/>
            Recursive Summarization + Agentic RAG
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>